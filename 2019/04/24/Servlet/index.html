<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>servlet |  个人博客</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="个人博客" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
      <canvas width="1777" height="841"
        style="position: fixed; left: 0px; top: 0px; z-index: 99999; pointer-events: none;"></canvas>
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-Servlet"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  servlet
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/04/24/Servlet/" class="article-date">
  <time datetime="2019-04-24T07:40:24.000Z" itemprop="datePublished">2019-04-24</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">16.5k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">78 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <meta name="referrer" content="no-referrer" />

<p>[toc]</p>
<h3 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h3><hr>
<h4 id="1-1-C-x2F-S架构和B-x2F-S架构"><a href="#1-1-C-x2F-S架构和B-x2F-S架构" class="headerlink" title="1.1 C&#x2F;S架构和B&#x2F;S架构"></a>1.1 C&#x2F;S架构和B&#x2F;S架构</h4><blockquote>
<p>C&#x2F;S和B&#x2F;S是软件发展过程中出现的两种软件架构方式。</p>
</blockquote>
<h4 id="1-2-C-x2F-S架构（Client-x2F-Server-客户端-x2F-服务器）"><a href="#1-2-C-x2F-S架构（Client-x2F-Server-客户端-x2F-服务器）" class="headerlink" title="1.2 C&#x2F;S架构（Client&#x2F;Server 客户端&#x2F;服务器）"></a>1.2 C&#x2F;S架构（Client&#x2F;Server 客户端&#x2F;服务器）</h4><blockquote>
<ul>
<li><p>特点：必须在客户端安装特定软件</p>
</li>
<li><p>优点：图形效果显示较好(如：3D游戏)</p>
</li>
<li><p>缺点：服务器的软件和功能进行升级，客户端也必须升级、不利于维护</p>
</li>
<li><p>常见的C&#x2F;S程序：QQ、微信等</p>
</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th align="center">C&#x2F;S架构</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/111C_S.png" alt="C_S"></td>
</tr>
</tbody></table>
<h4 id="1-3-B-x2F-S架构（Browser-x2F-Server-浏览器-x2F-服务器）"><a href="#1-3-B-x2F-S架构（Browser-x2F-Server-浏览器-x2F-服务器）" class="headerlink" title="1.3 B&#x2F;S架构（Browser&#x2F;Server 浏览器&#x2F;服务器）"></a>1.3 B&#x2F;S架构（Browser&#x2F;Server 浏览器&#x2F;服务器）</h4><blockquote>
<ul>
<li>特点：无需安装客户端，任何浏览器都可直接访问</li>
<li>优点：涉及到功能的升级，只需要升级服务器端</li>
<li>缺点：图形显示效果不如C&#x2F;S架构</li>
<li>需要通过HTTP协议访问</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th align="center">B&#x2F;S架构</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/111B_S.png" alt="B_S"></td>
</tr>
</tbody></table>
<h3 id="二-、服务器"><a href="#二-、服务器" class="headerlink" title="二 、服务器"></a>二 、服务器</h3><hr>
<h4 id="2-1-概念"><a href="#2-1-概念" class="headerlink" title="2.1 概念"></a>2.1 概念</h4><h5 id="2-1-1-什么是Web"><a href="#2-1-1-什么是Web" class="headerlink" title="2.1.1 什么是Web"></a>2.1.1 什么是Web</h5><blockquote>
<p>Web(World Wide Web) 称为万维网，简单理解就是网站，它用来表示Internet主机上供外界访问的资源。</p>
<p>Internet上供外界访问的资源分为两大类</p>
<ul>
<li><p>静态资源：指Web页面中供人们浏览的数据始终是不变的。(HTML、CSS)</p>
</li>
<li><p>动态资源：指Web页面中供人们浏览的数据是由程序产生的，不同时间点，甚至不同设备访问Web页面看到的内容各不相同。（JSP&#x2F;Servlet）</p>
</li>
</ul>
<ul>
<li>在Java中，动态Web资源开发技术我们统称为Java Web。</li>
</ul>
</blockquote>
<h5 id="2-1-2-什么是Web服务器"><a href="#2-1-2-什么是Web服务器" class="headerlink" title="2.1.2 什么是Web服务器"></a>2.1.2 什么是Web服务器</h5><blockquote>
<p>Web服务器是运行及发布Web应用的容器，只有将开发的Web项目放置到该容器中，才能使网络中的所有用户通过浏览器进行访问。</p>
</blockquote>
<h4 id="2-2-常见服务器"><a href="#2-2-常见服务器" class="headerlink" title="2.2 常见服务器"></a>2.2 常见服务器</h4><blockquote>
<ul>
<li>开源：OpenSource（1、开放源代码 2、免费）<ul>
<li>Tomcat(主流Web服务器之一，适合初学者)</li>
<li>jetty（淘宝，运行效率比Tomcat高）</li>
<li>resin（新浪，所有开源服务器软件中，运行效率最高的）</li>
<li>三者的用法从代码角度完全相同，只有在开启、关闭服务器软件时对应的命令稍有区别。掌握一个即掌握所有</li>
</ul>
</li>
<li>收费<ul>
<li>WebLogic（Oracle）</li>
<li>WebSphere（IBM）</li>
<li>提供相应的服务与支持，软件大，耗资源</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="2-3-Tomcat服务器"><a href="#2-3-Tomcat服务器" class="headerlink" title="2.3 Tomcat服务器"></a>2.3 Tomcat服务器</h4><blockquote>
<p>Tomcat是Apache 软件基金会（Apache Software Foundation）的Jakarta 项目中的一个核心项目，免费开源、并支持Servlet 和JSP 规范。目前Tomcat最新版本为9.0。</p>
<p>Tomcat 技术先进、性能稳定，深受Java 爱好者喜爱并得到了部分软件开发商的认可，成为目前比较流行的Web 应用服务器。</p>
</blockquote>
<h4 id="2-4-Tomcat安装"><a href="#2-4-Tomcat安装" class="headerlink" title="2.4 Tomcat安装"></a>2.4 Tomcat安装</h4><h5 id="2-4-1-下载"><a href="#2-4-1-下载" class="headerlink" title="2.4.1 下载"></a>2.4.1 下载</h5><blockquote>
<p>官网下载(<a target="_blank" rel="noopener" href="http://tomcat.apache.org/">http://tomcat.apache.org/</a>) Tomcat8.5解压缩版本</p>
</blockquote>
<h5 id="2-4-2-解压安装"><a href="#2-4-2-解压安装" class="headerlink" title="2.4.2 解压安装"></a>2.4.2 解压安装</h5><blockquote>
<p>将Tomcat解压到一个没有特殊符号的目录中（一般纯英文即可）</p>
<p>注意</p>
<ul>
<li>不建议将服务器软件放在磁盘层次很多的文件夹</li>
<li>不建议放在中文路径下</li>
</ul>
</blockquote>
<h5 id="2-4-3-Tomcat目录结构"><a href="#2-4-3-Tomcat目录结构" class="headerlink" title="2.4.3 Tomcat目录结构"></a>2.4.3 Tomcat目录结构</h5><table>
<thead>
<tr>
<th>文件夹</th>
<th align="left">说明</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>bin</td>
<td align="left">该目录下存放的是二进制可执行文件</td>
<td>startup.bat启动Tomcat、shutdown.bat停止Tomcat</td>
</tr>
<tr>
<td>conf</td>
<td align="left">这是一个非常重要的目录，这个目录下有两个最为重要的文件server.xml和web.xml</td>
<td>server.xml：配置整个服务器信息。例如修改端口号，编码格式等。<br/>web.xml：项目部署描述符文件，这个文件中注册了很多MIME类型，即文档类型。</td>
</tr>
<tr>
<td>lib</td>
<td align="left">Tomcat的类库，里面存放Tomcat运行所需要的jar文件。</td>
<td></td>
</tr>
<tr>
<td>logs</td>
<td align="left">存放日志文件，记录了Tomcat启动和关闭的信息，如果启动Tomcat时有错误，异常也会记录在日志文件中。</td>
<td></td>
</tr>
<tr>
<td>temp</td>
<td align="left">Tomcat的临时文件，这个目录下的东西在停止Tomcat后删除。</td>
<td></td>
</tr>
<tr>
<td>webapps</td>
<td align="left">存放web项目的目录，其中每个文件夹都是一个项目；其中ROOT是一个特殊的项目，在地址栏中没有给出项目目录时，对应的就是ROOT项目。</td>
<td></td>
</tr>
<tr>
<td>work</td>
<td align="left">运行时生成的文件，最终运行的文件都在这里。</td>
<td>当客户端用户访问一个JSP文件时，Tomcat会通过JSP生成Java文件，然后再编译Java文件生成class文件，生成的java和class文件都会存放到这个目录下。</td>
</tr>
</tbody></table>
<h4 id="2-5-Tomcat启动和停止"><a href="#2-5-Tomcat启动和停止" class="headerlink" title="2.5 Tomcat启动和停止"></a>2.5 Tomcat启动和停止</h4><h5 id="2-5-1-启动"><a href="#2-5-1-启动" class="headerlink" title="2.5.1 启动"></a>2.5.1 启动</h5><blockquote>
<p>进入tomcat安装目录bin下，双击startup.bat 启动程序，出现如下界面</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">Tomcat启动控制台</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="/Pictures/005.png"></td>
</tr>
</tbody></table>
<h5 id="2-5-2-验证"><a href="#2-5-2-验证" class="headerlink" title="2.5.2 验证"></a>2.5.2 验证</h5><blockquote>
<p>打开浏览器，输入 <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a></p>
<p>如果出现以下界面证明Tomcat启动成功。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">Tomcat访问页面</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/tomcat111.png"></td>
</tr>
</tbody></table>
<h5 id="2-5-3-停止"><a href="#2-5-3-停止" class="headerlink" title="2.5.3 停止"></a>2.5.3 停止</h5><blockquote>
<p>双击shutdown.bat即可关闭Tomcat启动窗口。</p>
</blockquote>
<h5 id="2-5-4-修改端口号"><a href="#2-5-4-修改端口号" class="headerlink" title="2.5.4 修改端口号"></a>2.5.4 修改端口号</h5><blockquote>
<p>Tomcat默认端口号为8080，可以通过conf&#x2F;server.xml文件修改</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="">注意：修改端口号需要重新启动Tomcat才能生效</a></li>
</ul>
<h4 id="2-6-项目部署及访问静态资源"><a href="#2-6-项目部署及访问静态资源" class="headerlink" title="2.6 项目部署及访问静态资源"></a>2.6 项目部署及访问静态资源</h4><blockquote>
<p>Tomcat是Web服务器，我们的项目应用是部署在webapps下，然后通过特定的<a href="">URL</a>访问。</p>
</blockquote>
<h5 id="2-6-1-创建项目"><a href="#2-6-1-创建项目" class="headerlink" title="2.6.1 创建项目"></a>2.6.1 创建项目</h5><blockquote>
<ul>
<li>在webapps中建立文件夹（项目应用），比如：myweb</li>
<li>创建WEB-INF文件夹，用于存放项目的核心内容<br>-  创建classes，用于存放.class文件<br>-  创建lib，用于存放jar文件<br>-  创建web.xml，项目配置文件（到ROOT项目下的WEB-INF复制即可）</li>
<li>把网页hello.html复制到myweb文件夹中，与WEB-INF在同级目录</li>
</ul>
</blockquote>
<h5 id="2-6-2-URL访问资源"><a href="#2-6-2-URL访问资源" class="headerlink" title="2.6.2 URL访问资源"></a>2.6.2 URL访问资源</h5><blockquote>
<p>浏览器地址中输入URL：<a target="_blank" rel="noopener" href="http://localhost:8080/myweb/hello.html">http://localhost:8080/myweb/hello.html</a></p>
</blockquote>
<ul>
<li><a href="">经验：URL主要有4部分组成：协议、主机、端口、资源路径</a></li>
</ul>
<table>
<thead>
<tr>
<th align="center">URL组成</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/111url.png" alt="url"></td>
</tr>
</tbody></table>
<h5 id="2-6-3-Tomcat响应流程图"><a href="#2-6-3-Tomcat响应流程图" class="headerlink" title="2.6.3 Tomcat响应流程图"></a>2.6.3 Tomcat响应流程图</h5><table>
<thead>
<tr>
<th align="center">请求响应流程图</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B111.png" alt="image-20200422205742782"></td>
</tr>
</tbody></table>
<h4 id="2-7-常见错误"><a href="#2-7-常见错误" class="headerlink" title="2.7 常见错误"></a>2.7 常见错误</h4><h5 id="2-7-1-Tomcat控制台闪退"><a href="#2-7-1-Tomcat控制台闪退" class="headerlink" title="2.7.1 Tomcat控制台闪退"></a>2.7.1 Tomcat控制台闪退</h5><blockquote>
<p>闪退问题是由于JAVA_HOME配置导致的，检查JAVA_HOME配置是否正确</p>
</blockquote>
<h5 id="2-7-2-404"><a href="#2-7-2-404" class="headerlink" title="2.7.2 404"></a>2.7.2 404</h5><blockquote>
<p>访问资源不存在，出现404错误</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">404错误</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/007123123.png" alt="007"></td>
</tr>
</tbody></table>
<h3 id="三-、Servlet【重点】"><a href="#三-、Servlet【重点】" class="headerlink" title="三 、Servlet【重点】"></a>三 、Servlet【<code>重点</code>】</h3><hr>
<h4 id="3-1-概念"><a href="#3-1-概念" class="headerlink" title="3.1 概念"></a>3.1 概念</h4><blockquote>
<ul>
<li>Servlet：Server Applet的简称，是服务器端的程序（代码、功能实现），可交互式的处理客户端发送到服务端的请求，并完成操作响应。</li>
<li>动态网页技术</li>
<li>JavaWeb程序开发的基础，JavaEE规范（一套接口）的一个组成部分。</li>
</ul>
</blockquote>
<h5 id="3-1-1-Servlet作用"><a href="#3-1-1-Servlet作用" class="headerlink" title="3.1.1 Servlet作用"></a>3.1.1 Servlet作用</h5><blockquote>
<ul>
<li>接收客户端请求，完成操作。 </li>
<li>动态生成网页（页面数据可变）。</li>
<li>将包含操作结果的动态网页响应给客户端。</li>
</ul>
</blockquote>
<h4 id="3-2-Servlet开发步骤"><a href="#3-2-Servlet开发步骤" class="headerlink" title="3.2 Servlet开发步骤"></a>3.2 Servlet开发步骤</h4><h5 id="3-2-1-搭建开发环境"><a href="#3-2-1-搭建开发环境" class="headerlink" title="3.2.1 搭建开发环境"></a>3.2.1 搭建开发环境</h5><blockquote>
<p>将Servlet相关jar包<a href="">(lib\servlet-api.jar)</a> 配置到classpath中</p>
</blockquote>
<h5 id="3-2-2-编写Servlet"><a href="#3-2-2-编写Servlet" class="headerlink" title="3.2.2 编写Servlet"></a>3.2.2 编写Servlet</h5><blockquote>
<ul>
<li>实现javax.servlet.Servlet</li>
<li>重写5个主要方法</li>
<li>在核心的service()方法中编写输出语句，打印访问结果</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.Servlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException&#123;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest request,ServletResponse response)</span> <span class="keyword">throws</span> ServletException,IOException&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;My First Servlet!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;	</span><br><span class="line">	&#125;	</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-2-3-部署Servlet"><a href="#3-2-3-部署Servlet" class="headerlink" title="3.2.3 部署Servlet"></a>3.2.3 部署Servlet</h5><blockquote>
<p>编译MyServlet后，将生成的.class文件放在WEB-INF&#x2F;classes文件中。</p>
</blockquote>
<h5 id="3-2-4-配置Servlet"><a href="#3-2-4-配置Servlet" class="headerlink" title="3.2.4 配置Servlet"></a>3.2.4 配置Servlet</h5><blockquote>
<p>编写WEB-INF下项目配置文件web.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span> <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">  	</span><br><span class="line">  <span class="comment">&lt;!--1、添加servlet节点--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.qf.servlet.MyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--2、添加servlet-mapping节点  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/myservlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="">注意：url-pattern配置的内容就是浏览器地址栏输入的URL中项目名称后资源的内容</a></li>
</ul>
<h4 id="3-3-运行测试"><a href="#3-3-运行测试" class="headerlink" title="3.3 运行测试"></a>3.3 运行测试</h4><blockquote>
<p>启动Tomcat，在浏览器地址栏中输入<a target="_blank" rel="noopener" href="http://localhost:8080/myweb/myservlet%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%9C%A8Tomcat%E4%B8%AD%E6%89%93%E5%8D%B0%E6%97%B6%E9%97%B4%E8%A1%A8%E7%A4%BA%E6%88%90%E5%8A%9F%E3%80%82">http://localhost:8080/myweb/myservlet访问，在Tomcat中打印时间表示成功。</a></p>
</blockquote>
<h4 id="3-4-常见错误"><a href="#3-4-常见错误" class="headerlink" title="3.4 常见错误"></a>3.4 常见错误</h4><h5 id="3-4-1-500错误"><a href="#3-4-1-500错误" class="headerlink" title="3.4.1 500错误"></a>3.4.1 500错误</h5><blockquote>
<p>服务端出现异常</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">500错误</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/0082312.png"></td>
</tr>
</tbody></table>
<h3 id="四、IDEA创建Web项目"><a href="#四、IDEA创建Web项目" class="headerlink" title="四、IDEA创建Web项目"></a>四、IDEA创建Web项目</h3><hr>
<h4 id="4-1-IDEA创建Web项目"><a href="#4-1-IDEA创建Web项目" class="headerlink" title="4.1 IDEA创建Web项目"></a>4.1 IDEA创建Web项目</h4><blockquote>
<p>创建项目窗口,选择JavaEE7,并勾选Web Application</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">创建Web项目</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/013231235.png"></td>
</tr>
</tbody></table>
<blockquote>
<p>输入项目名称和项目保存位置，点击Finish,完成项目创建</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">项目目录设置</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/01634234234.png"></td>
</tr>
</tbody></table>
<blockquote>
<p>Web项目目录介绍</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">目录结构</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/001deee7.png" alt="image-20200512142217351"></td>
</tr>
</tbody></table>
<h4 id="4-2-IDEA开发Servlet"><a href="#4-2-IDEA开发Servlet" class="headerlink" title="4.2 IDEA开发Servlet"></a>4.2 IDEA开发Servlet</h4><blockquote>
<p>使用开发工具编写Servlet，仍要手工导入<a href="">servlet-api.jar</a>文件，并与项目关联。</p>
</blockquote>
<h5 id="4-2-1-编写Servlet"><a href="#4-2-1-编写Servlet" class="headerlink" title="4.2.1 编写Servlet"></a>4.2.1 编写Servlet</h5><blockquote>
<p>创建MyServlet，实现Servlet接口，覆盖5个方法w</p>
</blockquote>
<h5 id="4-2-2-配置web-xml"><a href="#4-2-2-配置web-xml" class="headerlink" title="4.2.2 配置web.xml"></a>4.2.2 配置web.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span> <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">  	</span><br><span class="line">  <span class="comment">&lt;!--1添加servlet节点  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.qf.servlet.MyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--2添加servlet-mapping节点  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/myservlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="4-2-3-部署Web项目"><a href="#4-2-3-部署Web项目" class="headerlink" title="4.2.3 部署Web项目"></a>4.2.3 部署Web项目</h5><blockquote>
<ul>
<li>在Tomcat的webapps目录下，新建WebProject项目文件夹<ul>
<li>创建WEB-INF，存放核心文件</li>
<li>在WEB-INF下，创建classes文件夹，将编译后的MyServlet.class文件复制至此。</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li><a href="">问题：每当我们编写了新的Servlet或者重新编译，都需要手工将新的.class部署到Tomcat中，较为麻烦。如何实现自动部署？</a></li>
</ul>
<h4 id="4-3-IDEA部署Web项目"><a href="#4-3-IDEA部署Web项目" class="headerlink" title="4.3 IDEA部署Web项目"></a>4.3 IDEA部署Web项目</h4><blockquote>
<p>前面我们是在Tomcat的webapps目录新建应用程序目录myweb,然后把静态资源和Servlet复制到相关目录下。使用IDEA不需要我们复制了。可以通过IDEA集成Tomcat服务器，实现自动部署。</p>
</blockquote>
<h5 id="4-3-1-IDEA集成Tomcat"><a href="#4-3-1-IDEA集成Tomcat" class="headerlink" title="4.3.1 IDEA集成Tomcat"></a>4.3.1 IDEA集成Tomcat</h5><blockquote>
<p>点击File选项，选择Settings</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">Settings设置</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/013232328.png" alt="image-20200415224650181"></td>
</tr>
</tbody></table>
<blockquote>
<p>选择Build, Execution, Deployment下的Application Servers。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">应用服务器</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/033213212.png" alt="image-20200415224918038"></td>
</tr>
</tbody></table>
<blockquote>
<p>点击＋号，选择Tomcat Server</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">添加Tomcat服务器</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/0332321123.png" alt="image-20200415225206629"></td>
</tr>
</tbody></table>
<blockquote>
<p>选择Tomcat安装目录，点击OK即可</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">选择Tomcat目录</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/03423123.png" alt="image-20200415225302765"></td>
</tr>
</tbody></table>
<blockquote>
<p>最后，点击OK</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">点击OK</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/0332325.png" alt="image-20200415225420316"></td>
</tr>
</tbody></table>
<h5 id="4-3-2-项目部署Tomcat"><a href="#4-3-2-项目部署Tomcat" class="headerlink" title="4.3.2 项目部署Tomcat"></a>4.3.2 项目部署Tomcat</h5><blockquote>
<p>点击 Add Configuration </p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">添加项目配置</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122233241.png" alt="image-20200416110418929"></td>
</tr>
</tbody></table>
<blockquote>
<p>点击＋号，选择Tomcat Server，选择Local</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">选择Tomcat服务器</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122234068.png" alt="image-20200416110623115"></td>
</tr>
</tbody></table>
<blockquote>
<p>点击＋号 ，选择 Artifact，添加当前项目</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">添加当前项目</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="/Pictures%5C038.png" alt="image-20200416111320798"></td>
</tr>
</tbody></table>
<blockquote>
<p>点击运行按钮，即可运行项目</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">运行</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122234887.png" alt="image-20200416111837116"></td>
</tr>
</tbody></table>
<h4 id="4-4-其他操作"><a href="#4-4-其他操作" class="headerlink" title="4.4 其他操作"></a>4.4 其他操作</h4><h5 id="4-4-1-关联第三方jar包"><a href="#4-4-1-关联第三方jar包" class="headerlink" title="4.4.1 关联第三方jar包"></a>4.4.1 关联第三方jar包</h5><blockquote>
<p>在<a href="">WEB-INF</a>目录下新建lib目录</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">WEB-INF下新建lib目录</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122235436.png"></td>
</tr>
</tbody></table>
<blockquote>
<p>输入lib目录</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">文件夹名称</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122236286.png"></td>
</tr>
</tbody></table>
<blockquote>
<p>复制jar包到lib目录中</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">复制Jar文件</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122236263.png"></td>
</tr>
</tbody></table>
<blockquote>
<p>右击lib目录，选择Add as Library…</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">项目集成</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122236152.png"></td>
</tr>
</tbody></table>
<blockquote>
<p>选择Project Library,完成。</p>
<ul>
<li>Global Library  表示所有工程都可以使用。</li>
<li>Project Library 表示当前工程中所有模块都可以使用。</li>
<li>Module Library  表示当前模块可以使用。</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th align="center">关键项目环境</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122236837.png"></td>
</tr>
</tbody></table>
<h5 id="4-4-2-如何导出war包"><a href="#4-4-2-如何导出war包" class="headerlink" title="4.4.2 如何导出war包"></a>4.4.2 如何导出war包</h5><blockquote>
<p>项目完成后，有时候需要打成war方便部署。war包可以直接放入Tomcat的webapps目录中，启动Tomcat后自动解压，即可访问。</p>
</blockquote>
<blockquote>
<p>点击项目结构</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">项目结构配置</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122236398.png">****</td>
</tr>
</tbody></table>
<blockquote>
<p>选择Artifacts，点击+号</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">添加</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122236774.png"></td>
</tr>
</tbody></table>
<blockquote>
<p>选择Archive—&gt;For…</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">选择项目对应格式</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122236793.png"></td>
</tr>
</tbody></table>
<blockquote>
<p>构建项目</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">构建项目</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122236644.png"></td>
</tr>
</tbody></table>
<blockquote>
<p>在out\artifacts\目录中,查看生产的war包，把war放入Tomcat的webapps目录，启动Tomcat自动解压即可访问。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">War包目录</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122236923.png"></td>
</tr>
</tbody></table>
<h3 id="五、HTTP协议"><a href="#五、HTTP协议" class="headerlink" title="五、HTTP协议"></a>五、HTTP协议</h3><hr>
<h4 id="5-1-什么是HTTP"><a href="#5-1-什么是HTTP" class="headerlink" title="5.1 什么是HTTP"></a>5.1 什么是HTTP</h4><blockquote>
<p>超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议,是一个基于请求与响应模式的、无状态的、应用层的协议，运行于TCP协议基础之上。</p>
</blockquote>
<h4 id="5-2-HTTP协议特点"><a href="#5-2-HTTP协议特点" class="headerlink" title="5.2 HTTP协议特点"></a>5.2 HTTP协议特点</h4><blockquote>
<ul>
<li><p>支持客户端（浏览器）&#x2F;服务器模式。</p>
</li>
<li><p>简单快速：客户端只向服务器发送请求方法和路径，服务器即可响应数据，因而通信速度很快。请求方法常用的有GET、POST等。</p>
</li>
<li><p>灵活：HTTP允许传输任意类型的数据，传输的数据类型由Content-Type标识。</p>
</li>
<li><p>无连接：无连接指的是每次TCP连接只处理一个或多个请求，服务器处理完客户的请求后，即断开连接。采用这种方式可以节省传输时间。</p>
<ul>
<li>HTTP1.0版本是一个请求响应之后，直接就断开了。称为短连接。</li>
<li>HTTP1.1版本不是响应后直接就断开了，而是等几秒钟,这几秒钟之内有新的请求，那么还是通过之前的连接通道来收发消息，如果过了这几秒钟用户没有发送新的请求，就会断开连接。称为长连接。</li>
</ul>
</li>
<li><p>无状态：HTTP协议是无状态协议。</p>
<ul>
<li>无状态是指协议对于事务处理没有记忆能力。</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="5-3-HTTP协议通信流程"><a href="#5-3-HTTP协议通信流程" class="headerlink" title="5.3 HTTP协议通信流程"></a>5.3 HTTP协议通信流程</h4><blockquote>
<ul>
<li><p>客户与服务器建立连接（三次握手）。</p>
</li>
<li><p>客户向服务器发送请求。</p>
</li>
<li><p>服务器接受请求，并根据请求返回相应的文件作为应答。</p>
</li>
<li><p>客户与服务器关闭连接（四次挥手）。</p>
</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th align="center">HTTP原理</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122237543.png" alt="http"></td>
</tr>
</tbody></table>
<h4 id="5-4-请求报文和响应报文【了解】"><a href="#5-4-请求报文和响应报文【了解】" class="headerlink" title="5.4 请求报文和响应报文【了解】"></a>5.4 请求报文和响应报文【了解】</h4><h5 id="5-4-1-HTTP请求报文"><a href="#5-4-1-HTTP请求报文" class="headerlink" title="5.4.1 HTTP请求报文"></a>5.4.1 HTTP请求报文</h5><blockquote>
<p>当浏览器向Web服务器发出请求时，它向服务器传递了一个数据块，也就是请求信息（请求报文），HTTP请求信息由4部分组成：<br>1、请求行 请求方法&#x2F;地址 URI协议&#x2F;版本<br>2、请求头(Request Header)<br>3、空行<br>4、请求正文</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">请求报文</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122237833.png" alt="请求报文"></td>
</tr>
</tbody></table>
<h5 id="5-4-2-HTTP响应报文"><a href="#5-4-2-HTTP响应报文" class="headerlink" title="5.4.2 HTTP响应报文"></a>5.4.2 HTTP响应报文</h5><blockquote>
<p>HTTP响应报文与HTTP请求报文相似，HTTP响应也由4个部分组成：<br>1、状态行<br>2、响应头(Response Header)<br>3、空行<br>4、响应正文</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">响应报文</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122237453.png" alt="响应报文"></td>
</tr>
</tbody></table>
<h5 id="5-4-3-常见状态码"><a href="#5-4-3-常见状态码" class="headerlink" title="5.4.3 常见状态码"></a>5.4.3 常见状态码</h5><table>
<thead>
<tr>
<th>状态代码</th>
<th>状态描述</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td>OK</td>
<td>客户端请求成功</td>
</tr>
<tr>
<td>302</td>
<td>Found</td>
<td>临时重定向</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td>服务器收到请求，但是拒绝提供服务。服务器通常会在响应正文中给出不提供服务的原因</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td>请求的资源不存在，例如，输入了错误的URL。</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
<td>服务器发生不可预期的错误，导致无法完成客户端的请求。</td>
</tr>
</tbody></table>
<h3 id="六、Servlet详解【重点】"><a href="#六、Servlet详解【重点】" class="headerlink" title="六、Servlet详解【重点】"></a>六、Servlet详解【<code>重点</code>】</h3><hr>
<h4 id="6-1-Servlet核心接口和类"><a href="#6-1-Servlet核心接口和类" class="headerlink" title="6.1 Servlet核心接口和类"></a>6.1 Servlet核心接口和类</h4><blockquote>
<p>在Servlet体系结构中，除了实现Servlet接口，还可以通过继承GenericServlet 或 HttpServlet类，完成编写。</p>
</blockquote>
<h5 id="6-1-1-Servlet接口"><a href="#6-1-1-Servlet接口" class="headerlink" title="6.1.1 Servlet接口"></a>6.1.1 Servlet接口</h5><blockquote>
<p>在Servlet API中最重要的是Servlet接口，所有Servlet都会直接或间接的与该接口发生联系，或是直接实现该接口，或间接继承自实现了该接口的类。<br>该接口包括以下五个方法：</p>
<ul>
<li><p>init(ServletConfig config)</p>
</li>
<li><p>ServletConfig getServletConfig()</p>
</li>
<li><p>service(ServletRequest req,ServletResponse res)</p>
</li>
<li><p>String getServletInfo()</p>
</li>
<li><p>destroy( )</p>
</li>
</ul>
</blockquote>
<h5 id="6-1-2-GenericServlet抽象类"><a href="#6-1-2-GenericServlet抽象类" class="headerlink" title="6.1.2 GenericServlet抽象类"></a>6.1.2 GenericServlet抽象类</h5><blockquote>
<p>GenericServlet 使编写 Servlet 变得更容易。它提供生命周期方法 init 和 destroy 的简单实现，要编写一般的 Servlet，只需重写抽象 service 方法即可。 </p>
</blockquote>
<h5 id="6-1-3-HttpServlet类"><a href="#6-1-3-HttpServlet类" class="headerlink" title="6.1.3 HttpServlet类"></a>6.1.3 HttpServlet类</h5><blockquote>
<p>HttpServlet是继承GenericServlet的基础上进一步的扩展。<br>提供将要被子类化以创建适用于 Web 站点的 HTTP servlet 的抽象类。HttpServlet 的子类至少必须重写一个方法，该方法通常是以下这些方法之一：<br>    doGet，如果 servlet 支持 HTTP GET 请求<br>    doPost，用于 HTTP POST 请求<br>    doPut，用于 HTTP PUT 请求<br>    doDelete，用于 HTTP DELETE 请求 </p>
</blockquote>
<h4 id="6-2-Servlet两种创建方式"><a href="#6-2-Servlet两种创建方式" class="headerlink" title="6.2 Servlet两种创建方式"></a>6.2 Servlet两种创建方式</h4><h5 id="6-2-1-实现接口Servlet"><a href="#6-2-1-实现接口Servlet" class="headerlink" title="6.2.1 实现接口Servlet"></a>6.2.1 实现接口Servlet</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet创建的第一种方式：实现接口Servlet</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet2</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig arg0)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;OK&quot;</span>);</span><br><span class="line">		response.getWriter().println(<span class="string">&quot;welcome use servlet&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="">该方式比较麻烦，需要实现接口中所有方法。</a></li>
</ul>
<h5 id="6-2-2-继承HttpServlet（推荐）"><a href="#6-2-2-继承HttpServlet（推荐）" class="headerlink" title="6.2.2 继承HttpServlet（推荐）"></a>6.2.2 继承HttpServlet（推荐）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class HelloServlet</span></span><br><span class="line"><span class="comment"> * Servlet的第二种创建方式，继承HttpServlet.也是开发中推荐的</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		</span><br><span class="line">		response.getWriter().print(<span class="string">&quot;welcome use servlet&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-2-3-常见错误"><a href="#6-2-3-常见错误" class="headerlink" title="6.2.3 常见错误"></a>6.2.3 常见错误</h5><blockquote>
<ul>
<li><p>HTTP Status 404   资源找不到 。</p>
<ul>
<li>第一种情况：地址书写错误。</li>
<li>第二种情况：地址没有问题，把IDEA项目中out目录删除，然后重新运行。</li>
</ul>
</li>
<li><p>Serlvet地址配置重复。both mapped to the url-pattern [&#x2F;helloservlet] which is not permitted。</p>
</li>
<li><p>Serlvet地址配置错误。比如没有写&#x2F;  Invalid <url-pattern> [helloservlet2] in servlet mapping。</p>
</li>
</ul>
</blockquote>
<h4 id="6-3-Servlet两种配置方式"><a href="#6-3-Servlet两种配置方式" class="headerlink" title="6.3 Servlet两种配置方式"></a>6.3 Servlet两种配置方式</h4><h5 id="6-3-1-使用web-xml（Servlet2-5之前使用）"><a href="#6-3-1-使用web-xml（Servlet2-5之前使用）" class="headerlink" title="6.3.1 使用web.xml（Servlet2.5之前使用）"></a>6.3.1 使用web.xml（Servlet2.5之前使用）</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span> <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Web_Day11<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--Servlet的第二种配置  --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--Servlet配置  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--名称  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello2<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Servlet的全称类名  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.qf.web.servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--启动的优先级，数字越小越先起作用  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--映射配置  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--名称  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello2<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--资源的匹配规则：精确匹配  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello2<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>login.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="6-3-2-配置属性"><a href="#6-3-2-配置属性" class="headerlink" title="6.3.2 配置属性"></a>6.3.2 配置属性</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">url-pattern定义匹配规则，取值说明：</span><br><span class="line">精确匹配     /具体的名称		只有url路径是具体的名称的时候才会触发Servlet</span><br><span class="line">后缀匹配     *.xxx		   只要是以xxx结尾的就匹配触发Servlet</span><br><span class="line">通配符匹配   /* 			   匹配所有请求，包含服务器的所有资源</span><br><span class="line">通配符匹配   /             匹配所有请求，包含服务器的所有资源，不包括.jsp</span><br><span class="line"></span><br><span class="line">load-on-startup </span><br><span class="line">1元素标记容器是否应该在web应用程序启动的时候就加载这个servlet。</span><br><span class="line">2它的值必须是一个整数，表示servlet被加载的先后顺序。</span><br><span class="line">3如果该元素的值为负数或者没有设置，则容器会当Servlet被请求时再加载。</span><br><span class="line">4如果值为正整数或者0时，表示容器在应用启动时就加载并初始化这个servlet，值越小，servlet的优先级越高，就越先被加载。值相同时，容器就会自己选择顺序来加载。</span><br></pre></td></tr></table></figure>



<h5 id="6-3-3-使用注解-（Servlet3-0后支持，推荐）"><a href="#6-3-3-使用注解-（Servlet3-0后支持，推荐）" class="headerlink" title="6.3.3 使用注解 （Servlet3.0后支持，推荐）"></a>6.3.3 使用注解 （Servlet3.0后支持，推荐）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class HelloServlet</span></span><br><span class="line"><span class="comment"> * 演示Servlet注解式配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		</span><br><span class="line">		response.getWriter().print(<span class="string">&quot;OK&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="6-3-4-WebServlet注解常用属性"><a href="#6-3-4-WebServlet注解常用属性" class="headerlink" title="6.3.4 @WebServlet注解常用属性"></a>6.3.4 @WebServlet注解常用属性</h5><blockquote>
<ul>
<li><p>name: Serlvet名字 （可选）</p>
</li>
<li><p>value: 配置url路径,可以配置多个</p>
</li>
<li><p>urlPatterns：配置url路径 ，和value作用一样，不能同时使用</p>
</li>
<li><p>loadOnStartup:配置Servlet的创建的时机， 如果是0或者正数 启动程序时创建，如果是负数，则访问时创建。 数子越小优先级越高。</p>
</li>
</ul>
</blockquote>
<h3 id="七、Servlet应用【重点】"><a href="#七、Servlet应用【重点】" class="headerlink" title="七、Servlet应用【重点】"></a>七、Servlet应用【<code>重点</code>】</h3><hr>
<h4 id="7-1-request对象"><a href="#7-1-request对象" class="headerlink" title="7.1 request对象"></a>7.1 request对象</h4><blockquote>
<p>在Servlet中用来处理客户端请求需要用doGet或doPost方法的request对象</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">request</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122237202.png" alt="image-20200512135542823"></td>
</tr>
</tbody></table>
<h5 id="7-1-1-get和post区别"><a href="#7-1-1-get和post区别" class="headerlink" title="7.1.1 get和post区别"></a>7.1.1 get和post区别</h5><blockquote>
<p><a href="">get请求</a></p>
<ul>
<li>get提交的数据会放在URL之后，以?分割URL和传输数据，参数之间以&amp;相连</li>
<li>get方式明文传递，数据量小，不安全</li>
<li>效率高，浏览器默认请求方式为GET请求</li>
<li>对应的Servlet的方法是doGet</li>
</ul>
<p><a href="">post请求</a></p>
<ul>
<li>post方法是把提交的数据放在HTTP包的Body中</li>
<li>密文传递数据，数据量大，安全</li>
<li>效率相对没有GET高</li>
<li>对应的Servlet的方法是doPost</li>
</ul>
</blockquote>
<h5 id="7-1-2-request主要方法"><a href="#7-1-2-request主要方法" class="headerlink" title="7.1.2 request主要方法"></a>7.1.2 request主要方法</h5><table>
<thead>
<tr>
<th>方法名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>String getParameter(String name)</td>
<td>根据表单组件名称获取提交数据</td>
</tr>
<tr>
<td>void setCharacterEncoding(String charset)</td>
<td>指定每个请求的编码</td>
</tr>
</tbody></table>
<h5 id="7-1-3-request应用"><a href="#7-1-3-request应用" class="headerlink" title="7.1.3 request应用"></a>7.1.3 request应用</h5><blockquote>
<p>HTML页面</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>欢迎页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎你<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;HelloServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>姓名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>年龄：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>  <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>Servlet代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/HelloServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">//获取表单提交的姓名</span></span><br><span class="line">		String name=request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		<span class="comment">//获取年龄</span></span><br><span class="line">		String age=request.getParameter(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">		<span class="comment">//服务端输出打印</span></span><br><span class="line">		System.out.println(request.getRemoteAddr()+<span class="string">&quot;发来信息：姓名：&quot;</span>+name+<span class="string">&quot;----&gt;年龄：&quot;</span>+age);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="7-1-4-get请求收参问题"><a href="#7-1-4-get请求收参问题" class="headerlink" title="7.1.4 get请求收参问题"></a>7.1.4 get请求收参问题</h5><blockquote>
<p>产生乱码是因为服务器和客户端沟通的编码不一致造成的，因此解决的办法是：在客户端和服务器之间设置一个统一的编码，之后就按照此编码进行数据的传输和接收</p>
</blockquote>
<h5 id="7-1-5-get中文乱码"><a href="#7-1-5-get中文乱码" class="headerlink" title="7.1.5 get中文乱码"></a>7.1.5 get中文乱码</h5><blockquote>
<p>在Tomcat7及以下版本，客户端以UTF-8的编码传输数据到服务器端，而服务器端的request对象使用的是ISO8859-1这个字符编码来接收数据，服务器和客户端沟通的编码不一致因此才会产生中文乱码的。</p>
<ul>
<li><p>解决办法：在接收到数据后，先获取request对象以ISO8859-1字符编码接收到的原始数据的字节数组，然后通过字节数组以指定的编码构建字符串，解决乱码问题。</p>
</li>
<li><p>Tomcat8的版本中get方式不会出现乱码了，因为服务器对url的编码格式可以进行自动转换。</p>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class HelloServlet</span></span><br><span class="line"><span class="comment"> * 演示Servlet的GET请求,中文乱码的问题</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/GETServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">//获取表单提交的姓名</span></span><br><span class="line">		String name=request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		name=<span class="keyword">new</span> <span class="title class_">String</span>(name.getBytes(<span class="string">&quot;ISO8859-1&quot;</span>),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		<span class="comment">//获取年龄</span></span><br><span class="line">		String age=request.getParameter(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">		<span class="comment">//服务端输出打印</span></span><br><span class="line">		System.out.println(request.getRemoteAddr()+<span class="string">&quot;发来信息：姓名：&quot;</span>+name+<span class="string">&quot;----&gt;年龄：&quot;</span>+age);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="7-1-6-post中文乱码"><a href="#7-1-6-post中文乱码" class="headerlink" title="7.1.6 post中文乱码"></a>7.1.6 post中文乱码</h5><blockquote>
<p>由于客户端是以UTF-8字符编码将表单数据传输到服务器端的，因此服务器也需要设置以UTF-8字符编码进行接收。</p>
<ul>
<li>解决方案：使用从ServletRequest接口继承而来的setCharacterEncoding(charset)方法进行统一的编码设置。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class HelloServlet</span></span><br><span class="line"><span class="comment"> * 演示Servlet的GET请求,中文乱码的问题</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/GETServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">//设置请求参数的编码格式--对GET无效</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		<span class="comment">//获取表单提交的信息</span></span><br><span class="line">		String name=request.getParameter(<span class="string">&quot;msg&quot;</span>);</span><br><span class="line">		<span class="comment">//服务端输出打印</span></span><br><span class="line">		System.out.println(request.getRemoteAddr()+<span class="string">&quot;发来信息：&quot;</span>+msg);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-2-response对象"><a href="#7-2-response对象" class="headerlink" title="7.2 response对象"></a>7.2 response对象</h4><blockquote>
<p>response对象用于响应客户请求并向客户端输出信息。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">response</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122237632.png" alt="image-20200512135658133"></td>
</tr>
</tbody></table>
<h5 id="7-2-1-response主要方法"><a href="#7-2-1-response主要方法" class="headerlink" title="7.2.1 response主要方法"></a>7.2.1 response主要方法</h5><table>
<thead>
<tr>
<th align="left">方法名称</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">setHeader(name,value)</td>
<td align="left">设置响应信息头</td>
</tr>
<tr>
<td align="left">setContentType(String)</td>
<td align="left">设置响应文件类型、响应式的编码格式</td>
</tr>
<tr>
<td align="left">setCharacterEncoding(String)</td>
<td align="left">设置服务端响应内容编码格式</td>
</tr>
<tr>
<td align="left">getWriter()</td>
<td align="left">获取字符输出流</td>
</tr>
</tbody></table>
<h5 id="7-2-2-response应用"><a href="#7-2-2-response应用" class="headerlink" title="7.2.2 response应用"></a>7.2.2 response应用</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取请求参数代码省略</span></span><br><span class="line"><span class="comment">//获取输出流</span></span><br><span class="line">PrintWriter out=response.getWriter();</span><br><span class="line">out.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">out.println(<span class="string">&quot;&lt;head&gt;&lt;title&gt;login&lt;/title&gt;&lt;/head&gt;&quot;</span>);</span><br><span class="line">out.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">out.println(<span class="string">&quot;&lt;h1&gt;Login Success!!!&lt;/h1&gt;&quot;</span>);</span><br><span class="line"><span class="comment">//out.println(&quot;&lt;h1&gt;登录成功!!!&lt;/h1&gt;&quot;);</span></span><br><span class="line">out.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">out.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="">如果输出内容包含中文，则出现乱码，因为服务器默认采用ISO8859-1编码响应内容</a></li>
</ul>
<h5 id="7-2-3-解决输出中文乱码"><a href="#7-2-3-解决输出中文乱码" class="headerlink" title="7.2.3 解决输出中文乱码"></a>7.2.3 解决输出中文乱码</h5><blockquote>
<ul>
<li>设置服务器端响应的编码格式</li>
<li>设置客户端响应内容的头内容的文件类型及编码格式</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);<span class="comment">//设置响应编码格式为utf-8</span></span><br><span class="line">response.setHeader(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="">不推荐</a></li>
</ul>
<blockquote>
<p>同时设置服务端的编码格式和客户端响应的文件类型及响应时的编码格式</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="">推荐</a></li>
</ul>
<h4 id="7-3-综合案例-Servlet-JDBC"><a href="#7-3-综合案例-Servlet-JDBC" class="headerlink" title="7.3 综合案例(Servlet + JDBC)"></a>7.3 综合案例(Servlet + JDBC)</h4><blockquote>
<ul>
<li><p>要求：实现登录功能、展示所有用户功能</p>
</li>
<li><p>以下仅展示关键代码</p>
</li>
</ul>
</blockquote>
<h5 id="7-3-1-数据库"><a href="#7-3-1-数据库" class="headerlink" title="7.3.1 数据库"></a>7.3.1 数据库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE admin(</span><br><span class="line">	username VARCHAR(20) PRIMARY KEY,</span><br><span class="line">	PASSWORD VARCHAR(20) NOT NULL,</span><br><span class="line">    phone varchar(11) NOT NULL,</span><br><span class="line">    Address varchar(20) NOT NULL</span><br><span class="line">)CHARSET=utf8;</span><br><span class="line">INSERT INTO admin(username,PASSWORD,phone,address)</span><br><span class="line">VALUES(&#x27;gavin&#x27;,&#x27;123456&#x27;,&#x27;12345678901&#x27;,&#x27;北京市昌平区&#x27;);</span><br><span class="line">INSERT INTO admin(username,PASSWORD,phone,address)</span><br><span class="line">VALUES(&#x27;aaron&#x27;,&#x27;123456&#x27;,&#x27;12345678901&#x27;,&#x27;北京市昌平区&#x27;);</span><br></pre></td></tr></table></figure>



<h5 id="7-3-2-DBUtils"><a href="#7-3-2-DBUtils" class="headerlink" title="7.3.2 DBUtils"></a>7.3.2 DBUtils</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servletProject.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DruidDataSource ds;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Connection&gt; THREAD_LOCAL = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> DbUtils.class.getResourceAsStream(<span class="string">&quot;/database.properties&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(inputStream);</span><br><span class="line">            ds = (DruidDataSource) DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> THREAD_LOCAL.get();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (connection == <span class="literal">null</span>) &#123;</span><br><span class="line">                connection = ds.getConnection();</span><br><span class="line">                THREAD_LOCAL.set(connection);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">begin</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = getConnection();</span><br><span class="line">            connection.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = getConnection();</span><br><span class="line">            connection.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            closeAll(connection, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = getConnection();</span><br><span class="line">            connection.rollback();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            closeAll(connection, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">closeAll</span><span class="params">(Connection connection, Statement statement, ResultSet resultSet)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (resultSet != <span class="literal">null</span>) &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (statement != <span class="literal">null</span>) &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">                THREAD_LOCAL.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="7-3-3-AdminDaoImpl"><a href="#7-3-3-AdminDaoImpl" class="headerlink" title="7.3.3 AdminDaoImpl"></a>7.3.3 AdminDaoImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servletProject.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.dao.AdminDao;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.entity.Admin;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.utils.DbUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanListHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">AdminDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insert</span><span class="params">(Admin admin)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Admin admin)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Admin <span class="title function_">select</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> queryRunner.query(DbUtils.getConnection(),<span class="string">&quot;select * from admin where username=?;&quot;</span>,<span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;Admin&gt;(Admin.class),username);</span><br><span class="line">            <span class="keyword">return</span> admin;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Admin&gt; <span class="title function_">selectAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Admin&gt; admins = queryRunner.query(DbUtils.getConnection(),<span class="string">&quot;select * from admin&quot;</span>,<span class="keyword">new</span> <span class="title class_">BeanListHandler</span>&lt;Admin&gt;(Admin.class));</span><br><span class="line">            <span class="keyword">return</span> admins;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="7-3-4-AdminServiceImpl"><a href="#7-3-4-AdminServiceImpl" class="headerlink" title="7.3.4 AdminServiceImpl"></a>7.3.4 AdminServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servletProject.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.dao.AdminDao;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.dao.impl.AdminDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.entity.Admin;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.AdminService;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.utils.DbUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AdminService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">AdminDao</span> <span class="variable">adminDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminDaoImpl</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Admin <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="type">Admin</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DbUtils.begin();</span><br><span class="line">            <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> adminDao.select(username);</span><br><span class="line">            <span class="keyword">if</span>(admin!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(admin.getPassword().equals(password))&#123;</span><br><span class="line">                    result = admin;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            DbUtils.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            DbUtils.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Admin&gt; <span class="title function_">showAllAdmin</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Admin&gt; admins = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DbUtils.begin();</span><br><span class="line">            admins = adminDao.selectAll();</span><br><span class="line">            DbUtils.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            DbUtils.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> admins;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="7-3-5-HTML页面代码"><a href="#7-3-5-HTML页面代码" class="headerlink" title="7.3.5 HTML页面代码"></a>7.3.5 HTML页面代码</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/WebProject_war_exploded/login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="7-3-6-LoginServlet"><a href="#7-3-6-LoginServlet" class="headerlink" title="7.3.6 LoginServlet"></a>7.3.6 LoginServlet</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servletProject.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.entity.Admin;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.AdminService;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.impl.AdminServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(value = &quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">//1.收参</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="comment">//2.调用业务逻辑</span></span><br><span class="line">        <span class="type">AdminService</span> <span class="variable">adminService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminServiceImpl</span>();</span><br><span class="line">        <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> adminService.login(username,password);</span><br><span class="line">        <span class="comment">//3.处理结果</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">printWriter</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        <span class="keyword">if</span>(admin!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//响应给客户端一个结果页面，显示登录成功</span></span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;meta charset=&#x27;UTF-8&#x27;&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;title&gt;结果页面&lt;/title&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;h1&gt;登录成功！&lt;/h1&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//响应给客户端一个结果页面，显示登录失败！</span></span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;meta charset=&#x27;UTF-8&#x27;&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;title&gt;结果页面&lt;/title&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;h1&gt;登录失败！&lt;/h1&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="7-3-7-ShowAllAdminServlet"><a href="#7-3-7-ShowAllAdminServlet" class="headerlink" title="7.3.7 ShowAllAdminServlet"></a>7.3.7 ShowAllAdminServlet</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servletProject.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.entity.Admin;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.AdminService;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.impl.AdminServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(value = &quot;/showall&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllAdminServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="type">AdminService</span> <span class="variable">adminService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">        List&lt;Admin&gt; adminList = adminService.showAllAdmin();</span><br><span class="line"></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">printWriter</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(adminList!=<span class="literal">null</span>)&#123;</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;meta charset=&#x27;UTF-8&#x27;&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;title&gt;显示所有&lt;/title&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;table border=&#x27;1&#x27;&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;   &lt;tr&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;       &lt;td&gt;username&lt;/td&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;       &lt;td&gt;password&lt;/td&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;       &lt;td&gt;phone&lt;/td&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;       &lt;td&gt;address&lt;/td&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;   &lt;/tr&gt;&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(Admin admin : adminList)&#123;</span><br><span class="line">                printWriter.println(<span class="string">&quot;   &lt;tr&gt;&quot;</span>);</span><br><span class="line">                printWriter.println(<span class="string">&quot;       &lt;td&gt;&quot;</span>+admin.getUsername()+<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                printWriter.println(<span class="string">&quot;       &lt;td&gt;&quot;</span>+admin.getPassword()+<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                printWriter.println(<span class="string">&quot;       &lt;td&gt;&quot;</span>+admin.getPhone()+<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                printWriter.println(<span class="string">&quot;       &lt;td&gt;&quot;</span>+admin.getAddress()+<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                printWriter.println(<span class="string">&quot;   &lt;/tr&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/table&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;meta charset=&#x27;UTF-8&#x27;&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;title&gt;显示所有&lt;/title&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;h3&gt;当前没有用户！&lt;/h3&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="八、-转发与重定向"><a href="#八、-转发与重定向" class="headerlink" title="八、 转发与重定向"></a>八、 转发与重定向</h3><hr>
<h4 id="8-1-现有问题"><a href="#8-1-现有问题" class="headerlink" title="8.1 现有问题"></a>8.1 现有问题</h4><blockquote>
<p>在之前案例中，调用业务逻辑和显示结果页面都在同一个Servlet里，就会产生设计问题</p>
<ul>
<li>不符合单一职能原则、各司其职的思想</li>
<li>不利于后续的维护</li>
</ul>
<p>应该将业务逻辑和显示结果分离开</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">现阶段问题</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122237712.png" alt="image-20200421161151487"></td>
</tr>
</tbody></table>
<h5 id="8-1-1-业务、显示分离"><a href="#8-1-1-业务、显示分离" class="headerlink" title="8.1.1 业务、显示分离"></a>8.1.1 业务、显示分离</h5><table>
<thead>
<tr>
<th align="center">业务与显示分离</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122238430.png" alt="image-20200421161738926"></td>
</tr>
</tbody></table>
<ul>
<li><a href="">问题：业务逻辑和显示结果分离后，如何跳转到显示结果的Servlet？</a></li>
<li><a href="">业务逻辑得到的数据结果如何传递给显示结果的Servlet？</a></li>
</ul>
<h4 id="8-2-转发"><a href="#8-2-转发" class="headerlink" title="8.2 转发"></a>8.2 转发</h4><blockquote>
<p>转发的作用在服务器端，将请求发送给服务器上的其他资源，以共同完成一次请求的处理。</p>
</blockquote>
<h5 id="8-2-1-页面跳转"><a href="#8-2-1-页面跳转" class="headerlink" title="8.2.1 页面跳转"></a>8.2.1 页面跳转</h5><blockquote>
<p>在调用业务逻辑的Servlet中，编写以下代码</p>
<ul>
<li>request.getRequestDispatcher(“&#x2F;目标URL-pattern”).forward(request, response);</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th align="center">forward</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122238665.png" alt="image-20200421161418126"></td>
</tr>
</tbody></table>
<ul>
<li><a href="">使用forward跳转时，是在服务器内部跳转，地址栏不发生变化，属于同一次请求</a></li>
</ul>
<h5 id="8-2-2-数据传递"><a href="#8-2-2-数据传递" class="headerlink" title="8.2.2 数据传递"></a>8.2.2 数据传递</h5><blockquote>
<p>forward表示一次请求，是在服务器内部跳转，可以共享同一次request作用域中的数据</p>
<ul>
<li><p>request作用域：拥有存储数据的空间，作用范围是一次请求有效(一次请求可以经过多次转发)</p>
<ul>
<li>可以将数据存入request后，在一次请求过程中的任何位置进行获取</li>
<li>可传递任何数据(基本数据类型、对象、数组、集合等)</li>
</ul>
</li>
<li><p>存数据：request.setAttribute(key,value); </p>
<ul>
<li>以键值对形式存储在request作用域中。key为String类型，value为Object类型</li>
</ul>
</li>
<li><p>取数据：request.getAttribute(key);</p>
<ul>
<li>通过String类型的key访问Object类型的value</li>
</ul>
</li>
</ul>
</blockquote>
<h5 id="8-2-3-转发特点"><a href="#8-2-3-转发特点" class="headerlink" title="8.2.3 转发特点"></a>8.2.3 转发特点</h5><blockquote>
<ul>
<li><p>转发是服务器行为</p>
</li>
<li><p>转发是浏览器只做了一次访问请求</p>
</li>
<li><p>转发浏览器地址不变</p>
</li>
<li><p>转发两次跳转之间传输的信息不会丢失，所以可以通过request进行数据的传递、</p>
</li>
<li><p>转发只能将请求转发给同一个Web应用中的组件</p>
</li>
</ul>
</blockquote>
<h4 id="8-3-重定向"><a href="#8-3-重定向" class="headerlink" title="8.3 重定向"></a>8.3 重定向</h4><blockquote>
<p>重定向作用在客户端，客户端将请求发送给服务器后，服务器响应给客户端一个新的请求地址，客户端重新发送新请求。</p>
</blockquote>
<h5 id="8-3-1-页面跳转"><a href="#8-3-1-页面跳转" class="headerlink" title="8.3.1 页面跳转"></a>8.3.1 页面跳转</h5><blockquote>
<p>在调用业务逻辑的Servlet中，编写以下代码</p>
<ul>
<li>response.sendRedirect(“目标URI”);</li>
</ul>
</blockquote>
<ul>
<li><a href="">URI:统一资源标识符(Uniform Resource Identifier)，用来表示服务器中定位一个资源，资源在web项目中的路径(&#x2F;project&#x2F;source)</a></li>
</ul>
<table>
<thead>
<tr>
<th align="center">redirect</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122238053.png" alt="image-20200512151855703"></td>
</tr>
</tbody></table>
<ul>
<li><a href="">使用redirect跳转时，是在客户端跳转，地址栏发生变化，属于多次请求</a></li>
</ul>
<h5 id="8-3-2-数据传递"><a href="#8-3-2-数据传递" class="headerlink" title="8.3.2 数据传递"></a>8.3.2 数据传递</h5><blockquote>
<p>sendRedirect跳转时，地址栏改变，代表客户端重新发送的请求。属于两次请求</p>
<ul>
<li>response没有作用域，两次request请求中的数据无法共享</li>
<li>传递数据：通过URI的拼接进行数据传递(“&#x2F;WebProject&#x2F;b?username&#x3D;tom”);</li>
<li>获取数据：request.getParameter(“username”);</li>
</ul>
</blockquote>
<h5 id="8-3-3-重定向特点"><a href="#8-3-3-重定向特点" class="headerlink" title="8.3.3 重定向特点"></a>8.3.3 重定向特点</h5><blockquote>
<ul>
<li><p>重定向是客户端行为。</p>
</li>
<li><p>重定向是浏览器做了至少两次的访问请求。</p>
</li>
<li><p>重定向浏览器地址改变。</p>
</li>
<li><p>重定向两次跳转之间传输的信息会丢失（request范围）。</p>
</li>
<li><p>重定向可以指向任何的资源，包括当前应用程序中的其他资源、同一个站点上的其他应用程序中的资源、其他站点的资源。</p>
</li>
</ul>
</blockquote>
<h4 id="8-4-转发、重定向总结"><a href="#8-4-转发、重定向总结" class="headerlink" title="8.4 转发、重定向总结"></a>8.4 转发、重定向总结</h4><blockquote>
<p>当两个Servlet需要传递数据时，选择forward转发。不建议使用sendRedirect进行传递</p>
</blockquote>
<h3 id="九、-Servlet生命周期"><a href="#九、-Servlet生命周期" class="headerlink" title="九、 Servlet生命周期"></a>九、 Servlet生命周期</h3><hr>
<h4 id="9-1-生命周期四个阶段"><a href="#9-1-生命周期四个阶段" class="headerlink" title="9.1 生命周期四个阶段"></a>9.1 生命周期四个阶段</h4><h5 id="9-1-1-实例化"><a href="#9-1-1-实例化" class="headerlink" title="9.1.1 实例化"></a>9.1.1 实例化</h5><blockquote>
<p>当用户第一次访问Servlet时，由容器调用Servlet的构造器创建具体的Servlet对象。也可以在容器启动之后立刻创建实例。使用如下代码可以设置Servlet是否在服务器启动时就创建。<br><load-on-startup>1</load-on-startup> </p>
<ul>
<li>注意：只执行一次</li>
</ul>
</blockquote>
<h5 id="9-1-2-初始化"><a href="#9-1-2-初始化" class="headerlink" title="9.1.2 初始化"></a>9.1.2 初始化</h5><blockquote>
<p>在初始化阶段，init()方法会被调用。这个方法在javax.servlet.Servlet接口中定义。其中，方法以一个ServletConfig类型的对象作为参数。</p>
<ul>
<li>注意：init方法只被执行一次</li>
</ul>
</blockquote>
<h5 id="9-1-3-服务"><a href="#9-1-3-服务" class="headerlink" title="9.1.3 服务"></a>9.1.3 服务</h5><blockquote>
<p>当客户端有一个请求时，容器就会将请求ServletRequest与响应ServletResponse对象转给Servlet，以参数的形式传给service方法。</p>
<ul>
<li>此方法会执行多次</li>
</ul>
</blockquote>
<h5 id="9-1-4-销毁"><a href="#9-1-4-销毁" class="headerlink" title="9.1.4 销毁"></a>9.1.4 销毁</h5><blockquote>
<p>当Servlet容器停止或者重新启动都会引起销毁Servlet对象并调用destroy方法。</p>
<ul>
<li>destroy方法执行一次</li>
</ul>
</blockquote>
<h5 id="9-1-5-Servlet执行流程"><a href="#9-1-5-Servlet执行流程" class="headerlink" title="9.1.5 Servlet执行流程"></a>9.1.5 Servlet执行流程</h5><table>
<thead>
<tr>
<th align="center">Servlet执行流程</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122238272.png" alt="Servlet声明周期"></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class LifeServlet</span></span><br><span class="line"><span class="comment"> * 演示Servlet的生命周期：</span></span><br><span class="line"><span class="comment"> * 1、实例化</span></span><br><span class="line"><span class="comment"> * 2、init:初始化</span></span><br><span class="line"><span class="comment"> * 3、service：服务</span></span><br><span class="line"><span class="comment"> * 4、destory：销毁</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/lifeservlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LifeServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LifeServlet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;1、完成了实例化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    	<span class="built_in">super</span>.init();</span><br><span class="line">    	System.out.println(<span class="string">&quot;2、完成了初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;3、就绪中&quot;</span>);</span><br><span class="line">		response.getWriter().append(<span class="string">&quot;Served at: &quot;</span>).append(request.getContextPath());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>.destroy();</span><br><span class="line">		System.out.println(<span class="string">&quot;4、销毁了&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="十、Servlet特性"><a href="#十、Servlet特性" class="headerlink" title="十、Servlet特性"></a>十、Servlet特性</h3><hr>
<h4 id="10-1-线程安全问题"><a href="#10-1-线程安全问题" class="headerlink" title="10.1 线程安全问题"></a>10.1 线程安全问题</h4><blockquote>
<p>Servlet在访问之后，会执行实例化操作，创建一个Servlet对象。而我们Tomcat容器可以同时多个线程并发访问同一个Servlet，如果在方法中对成员变量做修改操作，就会有线程安全的问题。</p>
</blockquote>
<h4 id="10-2-如何保证线程安全"><a href="#10-2-如何保证线程安全" class="headerlink" title="10.2 如何保证线程安全"></a>10.2 如何保证线程安全</h4><blockquote>
<ul>
<li><p>synchronized</p>
<ul>
<li>将存在线程安全问题的代码放到同步代码块中</li>
</ul>
</li>
<li><p>实现SingleThreadModel接口</p>
<ul>
<li>servlet实现SingleThreadModel接口后，每个线程都会创建servlet实例，这样每个客户端请求就不存在共享资源的问题，但是servlet响应客户端请求的效率太低，所以已经淘汰。</li>
</ul>
</li>
<li><p>尽可能使用局部变量</p>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servlet3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.SingleThreadModel;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span>  <span class="keyword">implements</span> <span class="title class_">SingleThreadModel</span> &#123;</span><br><span class="line">     <span class="comment">//private String message = &quot;&quot;;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//假设1、接收参数</span></span><br><span class="line">        <span class="comment">//2、调用业务逻辑 得到登录结果</span></span><br><span class="line">        message = <span class="string">&quot;登录成功&quot;</span>;<span class="comment">//登录失败！</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">printWriter</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        printWriter.println(message);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="十一、状态管理"><a href="#十一、状态管理" class="headerlink" title="十一、状态管理"></a>十一、状态管理</h3><hr>
<h4 id="11-1-现有问题"><a href="#11-1-现有问题" class="headerlink" title="11.1 现有问题"></a>11.1 现有问题</h4><blockquote>
<ul>
<li><p>HTTP协议是无状态的，不能保存每次提交的信息</p>
</li>
<li><p>如果用户发来一个新的请求，服务器无法知道它是否与上次的请求有联系。</p>
</li>
<li><p>对于那些需要多次提交数据才能完成的Web操作，比如登录来说，就成问题了。</p>
</li>
</ul>
</blockquote>
<h4 id="11-2-概念"><a href="#11-2-概念" class="headerlink" title="11.2 概念"></a>11.2 概念</h4><blockquote>
<p>将浏览器与web服务器之间多次交互当作一个整体来处理，并且将多次交互所涉及的数据（即状态）保存下来。</p>
</blockquote>
<h4 id="11-3-状态管理分类"><a href="#11-3-状态管理分类" class="headerlink" title="11.3 状态管理分类"></a>11.3 状态管理分类</h4><blockquote>
<ul>
<li><p>客户端状态管理技术：将状态保存在客户端。代表性的是Cookie技术。</p>
</li>
<li><p>服务器状态管理技术：将状态保存在服务器端。代表性的是session技术（服务器传递sessionID时需要使用Cookie的方式）</p>
</li>
</ul>
</blockquote>
<h3 id="十二、Cookie的使用"><a href="#十二、Cookie的使用" class="headerlink" title="十二、Cookie的使用"></a>十二、Cookie的使用</h3><hr>
<h4 id="12-1-什么是Cookie"><a href="#12-1-什么是Cookie" class="headerlink" title="12.1 什么是Cookie"></a>12.1 什么是Cookie</h4><blockquote>
<ul>
<li><p>Cookie是在浏览器访问Web服务器的某个资源时，由Web服务器在HTTP响应消息头中附带传送给浏览器的一小段数据。</p>
</li>
<li><p>一旦Web浏览器保存了某个Cookie，那么它在以后每次访问该Web服务器时，都应在HTTP请求头中将这个Cookie回传给Web服务器。</p>
</li>
<li><p>一个Cookie主要由标识该信息的名称（name）和值（value）组成。</p>
</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th align="center">Cookie原理</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122238991.png" alt="image-20200420113202276"></td>
</tr>
</tbody></table>
<h4 id="12-2-创建Cookie"><a href="#12-2-创建Cookie" class="headerlink" title="12.2 创建Cookie"></a>12.2 创建Cookie</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建Cookie</span></span><br><span class="line">Cookie ck=<span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">ck.setPath(<span class="string">&quot;/webs&quot;</span>);<span class="comment">//设置Cookie的路径</span></span><br><span class="line">ck.setMaxAge(-<span class="number">1</span>);<span class="comment">//内存存储，取值有三种：&gt;0有效期，单位秒；=0浏览器关闭；&lt;0内存存储,默认-1</span></span><br><span class="line">response.addCookie(ck);<span class="comment">//添加到response对象中，响应时发送给客户端</span></span><br><span class="line">      <span class="comment">//注意：有效路径: 当前访问资源的上一级目录，不带主机名</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="">chrome浏览器查看cookie信息：chrome:&#x2F;&#x2F;settings&#x2F;content&#x2F;cookies</a></li>
</ul>
<h4 id="12-3-获取Cookie"><a href="#12-3-获取Cookie" class="headerlink" title="12.3 获取Cookie"></a>12.3 获取Cookie</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取所有的Cookie</span></span><br><span class="line">Cookie[] cks=request.getCookies();</span><br><span class="line">		<span class="comment">//遍历Cookie</span></span><br><span class="line">		<span class="keyword">for</span>(Cookie ck:cks)&#123;</span><br><span class="line">          <span class="comment">//检索出自己的Cookie</span></span><br><span class="line">			<span class="keyword">if</span>(ck.getName().equals(<span class="string">&quot;code&quot;</span>))</span><br><span class="line">			&#123;</span><br><span class="line">              <span class="comment">//记录Cookie的值</span></span><br><span class="line">				code=ck.getValue();</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>



<h4 id="12-4-修改Cookie"><a href="#12-4-修改Cookie" class="headerlink" title="12.4 修改Cookie"></a>12.4 修改Cookie</h4><blockquote>
<p>只需要保证Cookie的名和路径一致即可修改</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改Cookie</span></span><br><span class="line">   Cookie ck=<span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">   ck.setPath(<span class="string">&quot;/webs&quot;</span>);<span class="comment">//设置Cookie的路径</span></span><br><span class="line">   ck.setMaxAge(-<span class="number">1</span>);<span class="comment">//内存存储，取值有三种：&gt;0有效期，单位秒；=0失效；&lt;0内存存储</span></span><br><span class="line">   response.addCookie(ck);<span class="comment">//让浏览器添加Cookie</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="">注意：如果改变cookie的name和有效路径会新建cookie, 而改变cookie值、有效期会覆盖原有cookie</a></li>
</ul>
<h4 id="12-5-Cookie编码与解码"><a href="#12-5-Cookie编码与解码" class="headerlink" title="12.5 Cookie编码与解码"></a>12.5 Cookie编码与解码</h4><blockquote>
<p>Cookie默认不支持中文，只能包含ASCII字符，所以Cookie需要对Unicode字符进行编码，否则会出现乱码。</p>
<ul>
<li><p>编码可以使用java.net.URLEncoder类的encode(String str,String encoding)方法</p>
</li>
<li><p>解码使用java.net.URLDecoder类的decode(String str,String encoding)方法</p>
</li>
</ul>
</blockquote>
<h5 id="12-5-1-创建带中文Cookie"><a href="#12-5-1-创建带中文Cookie" class="headerlink" title="12.5.1 创建带中文Cookie"></a>12.5.1 创建带中文Cookie</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用中文的 Cookie. name 与 value 都使用 UTF-8 编码. </span></span><br><span class="line">   <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(</span><br><span class="line">       URLEncoder.encode(<span class="string">&quot;姓名&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>), </span><br><span class="line">       URLEncoder.encode(<span class="string">&quot;老邢&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">   <span class="comment">// 发送到客户端   </span></span><br><span class="line">   response.addCookie(cookie);</span><br></pre></td></tr></table></figure>



<h5 id="12-5-2-读取带中文Cookie"><a href="#12-5-2-读取带中文Cookie" class="headerlink" title="12.5.2 读取带中文Cookie"></a>12.5.2 读取带中文Cookie</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(request.getCookies() != <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span>(Cookie cc : request.getCookies())&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cookieName</span> <span class="operator">=</span> URLDecoder.decode(cc.getName(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">cookieValue</span> <span class="operator">=</span> URLDecoder.decode(cc.getValue(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        out.println(cookieName + <span class="string">&quot;=&quot;</span>);</span><br><span class="line">        out.println(cookieValue + <span class="string">&quot;; &lt;br/&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    out.println(<span class="string">&quot;Cookie 已经写入客户端. 请刷新页面. &quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="12-6-Cookie优点和缺点"><a href="#12-6-Cookie优点和缺点" class="headerlink" title="12.6 Cookie优点和缺点"></a>12.6 Cookie优点和缺点</h4><h5 id="12-6-1-优点"><a href="#12-6-1-优点" class="headerlink" title="12.6.1 优点"></a>12.6.1 优点</h5><blockquote>
<ul>
<li><p>可配置到期规则。</p>
</li>
<li><p>简单性：Cookie 是一种基于文本的轻量结构，包含简单的键值对。</p>
</li>
<li><p>数据持久性：Cookie默认在过期之前是可以一直存在客户端浏览器上的。</p>
</li>
</ul>
</blockquote>
<h5 id="12-6-2-缺点"><a href="#12-6-2-缺点" class="headerlink" title="12.6.2 缺点"></a>12.6.2 缺点</h5><blockquote>
<ul>
<li><p>大小受到限制：大多数浏览器对 Cookie 的大小有 4K、8K字节的限制。</p>
</li>
<li><p>用户配置为禁用：有些用户禁用了浏览器或客户端设备接收 Cookie 的能力，因此限制了这一功能。、</p>
</li>
<li><p>潜在的安全风险：Cookie 可能会被篡改。会对安全性造成潜在风险或者导致依赖于Cookie 的应用程序失败。</p>
</li>
</ul>
</blockquote>
<h3 id="十三、Session对象【重点】"><a href="#十三、Session对象【重点】" class="headerlink" title="十三、Session对象【重点】"></a>十三、Session对象【<code>重点</code>】</h3><hr>
<h4 id="13-1-Session概述"><a href="#13-1-Session概述" class="headerlink" title="13.1 Session概述"></a>13.1 Session概述</h4><blockquote>
<ul>
<li>Session用于记录用户的状态。Session指的是在一段时间内，单个客户端与Web服务器的一连串相关的交互过程。</li>
<li>在一个Session中，客户可能会多次请求访问同一个资源，也有可能请求访问各种不同的服务器资源。</li>
</ul>
</blockquote>
<h4 id="13-2-Session原理"><a href="#13-2-Session原理" class="headerlink" title="13.2 Session原理"></a>13.2 Session原理</h4><blockquote>
<ul>
<li><p>服务器会为每一次会话分配一个Session对象</p>
</li>
<li><p>同一个浏览器发起的多次请求，同属于一次会话(Session)</p>
</li>
<li><p>首次使用到Session时，服务器会自动创建Session，并创建Cookie存储SessionId发送回客户端</p>
</li>
</ul>
</blockquote>
<ul>
<li><a href="">注意：session是由服务端创建的。</a></li>
</ul>
<h4 id="13-3-Session使用"><a href="#13-3-Session使用" class="headerlink" title="13.3 Session使用"></a>13.3 Session使用</h4><blockquote>
<ul>
<li>Session作用域：拥有存储数据的空间，作用范围是一次会话有效<ul>
<li>一次会话是使用同一浏览器发送的多次请求。一旦浏览器关闭，则结束会话</li>
<li>可以将数据存入Session中，在一次会话的任意位置进行获取</li>
<li>可传递任何数据(基本数据类型、对象、集合、数组)</li>
</ul>
</li>
</ul>
</blockquote>
<h5 id="13-3-1-获取Session"><a href="#13-3-1-获取Session" class="headerlink" title="13.3.1 获取Session"></a>13.3.1 获取Session</h5><blockquote>
<p>session是服务器端自动创建的，通过request对象获取</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">//获取Session对象</span></span><br><span class="line">HttpSession session=request.getSession();</span><br><span class="line">System.out.println(<span class="string">&quot;Id：&quot;</span>+session.getId());<span class="comment">//唯一标记，</span></span><br></pre></td></tr></table></figure>



<h5 id="13-3-2-Session保存数据"><a href="#13-3-2-Session保存数据" class="headerlink" title="13.3.2 Session保存数据"></a>13.3.2 Session保存数据</h5><blockquote>
<p>​	setAttribute(属性名,Object)保存数据到session中</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.setAttribute(<span class="string">&quot;key&quot;</span>,value);<span class="comment">//以键值对形式存储在session作用域中。</span></span><br></pre></td></tr></table></figure>



<h5 id="13-3-3-Session获取数据"><a href="#13-3-3-Session获取数据" class="headerlink" title="13.3.3 Session获取数据"></a>13.3.3 Session获取数据</h5><blockquote>
<p>​	getAttribute(属性名);获取session中数据</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.getAttribute(<span class="string">&quot;key&quot;</span>);<span class="comment">//通过String类型的key访问Object类型的value</span></span><br></pre></td></tr></table></figure>



<h5 id="13-3-4-Session移除数据"><a href="#13-3-4-Session移除数据" class="headerlink" title="13.3.4 Session移除数据"></a>13.3.4 Session移除数据</h5><blockquote>
<p>​	removeAttribute(属性名);从session中删除数据	</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.removeAttribute(<span class="string">&quot;key&quot;</span>);<span class="comment">//通过键移除session作用域中的值</span></span><br></pre></td></tr></table></figure>



<h4 id="13-4-Session与Request应用区别"><a href="#13-4-Session与Request应用区别" class="headerlink" title="13.4 Session与Request应用区别"></a>13.4 Session与Request应用区别</h4><blockquote>
<ul>
<li>request是一次请求有效，请求改变，则request改变</li>
<li>session是一次会话有效，浏览器改变，则session改变</li>
</ul>
</blockquote>
<h5 id="13-4-1-Session应用"><a href="#13-4-1-Session应用" class="headerlink" title="13.4.1 Session应用"></a>13.4.1 Session应用</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.sessions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;SessionServlet&quot;,value = &quot;/ss&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.通过request对象获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.使用session保存数据</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;gavin&quot;</span>);</span><br><span class="line">        request.setAttribute(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;/WebProject_war_exploded/getValue&quot;</span>);</span><br><span class="line">        System.out.println(session.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="13-4-2-GetValueServlet-java"><a href="#13-4-2-GetValueServlet-java" class="headerlink" title="13.4.2 GetValueServlet.java"></a>13.4.2 GetValueServlet.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.sessions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;GetValueServlet&quot;,value = &quot;/getValue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetValueServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.通过request获取session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> (String)request.getAttribute(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;从session中获得了：&quot;</span>+s);</span><br><span class="line">        System.out.println(<span class="string">&quot;从reqeust中获得了：&quot;</span>+password);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="13-5-Session的生命周期"><a href="#13-5-Session的生命周期" class="headerlink" title="13.5 Session的生命周期"></a>13.5 Session的生命周期</h4><blockquote>
<ul>
<li><p>开始：第一次使用到Session的请求产生，则创建Session</p>
</li>
<li><p>结束：</p>
<ul>
<li>浏览器关闭，则失效</li>
<li>Session超时，则失效<ul>
<li>session.setMaxInactiveInterval(seconds);&#x2F;&#x2F;设置最大有效时间(单位：秒)</li>
</ul>
</li>
<li>手工销毁，则失效<ul>
<li>session.invalidate();&#x2F;&#x2F;登录退出、注销</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<h5 id="13-5-1-Session失效"><a href="#13-5-1-Session失效" class="headerlink" title="13.5.1 Session失效"></a>13.5.1 Session失效</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">session.setMaxInactiveInterval(<span class="number">60</span>*<span class="number">60</span>);<span class="comment">//设置session最大有效期为一小时</span></span><br><span class="line"></span><br><span class="line">session.invalidate();<span class="comment">//手工销毁</span></span><br></pre></td></tr></table></figure>





<h4 id="13-4-浏览器禁用Cookie解决方案【了解】"><a href="#13-4-浏览器禁用Cookie解决方案【了解】" class="headerlink" title="13.4 浏览器禁用Cookie解决方案【了解】"></a>13.4 浏览器禁用Cookie解决方案【了解】</h4><h5 id="13-4-1-浏览器禁用Cookie的后果"><a href="#13-4-1-浏览器禁用Cookie的后果" class="headerlink" title="13.4.1 浏览器禁用Cookie的后果"></a>13.4.1 浏览器禁用Cookie的后果</h5><blockquote>
<p>服务器在默认情况下，会使用Cookie的方式将sessionID发送给浏览器，如果用户禁止Cookie，则sessionID不会被浏览器保存，此时，服务器可以使用如URL重写这样的方式来发送sessionID。</p>
</blockquote>
<h5 id="13-4-2-URL重写"><a href="#13-4-2-URL重写" class="headerlink" title="13.4.2 URL重写"></a>13.4.2 URL重写</h5><blockquote>
<p>浏览器在访问服务器上的某个地址时，不再使用原来的那个地址，而是使用经过改写的地址（即在原来的地址后面加上了sessionID）。</p>
</blockquote>
<h5 id="13-4-3-实现URL重写"><a href="#13-4-3-实现URL重写" class="headerlink" title="13.4.3 实现URL重写"></a>13.4.3 实现URL重写</h5><blockquote>
<p>response.encodeRedirectURL(String url)生成重写的URL。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	<span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"><span class="comment">//重写URL追加SessionId</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">newUrl</span> <span class="operator">=</span> response.encodeRedirectURL(<span class="string">&quot;/WebProject_war_exploded/cs&quot;</span>);</span><br><span class="line">    System.out.println(newUrl);</span><br><span class="line">		</span><br><span class="line">    response.sendRedirect(newUrl2);</span><br></pre></td></tr></table></figure>



<h4 id="13-5-Session实战权限验证"><a href="#13-5-Session实战权限验证" class="headerlink" title="13.5 Session实战权限验证"></a>13.5 Session实战权限验证</h4><table>
<thead>
<tr>
<th align="center">Session记录登录状态</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122238215.png" alt="image-20200422105652452"></td>
</tr>
</tbody></table>
<h5 id="13-5-1-创建管理员表"><a href="#13-5-1-创建管理员表" class="headerlink" title="13.5.1 创建管理员表"></a>13.5.1 创建管理员表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Manager(</span><br><span class="line">	username VARCHAR(20) PRIMARY KEY,</span><br><span class="line">    password VARCHAR(20) NOT NULL</span><br><span class="line">)charset=utf8;</span><br></pre></td></tr></table></figure>



<h5 id="13-5-2-登录页面"><a href="#13-5-2-登录页面" class="headerlink" title="13.5.2 登录页面"></a>13.5.2 登录页面</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>管理员登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/WebProject_war_exploded/loginMgr&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="13-5-3-LoginMgrController"><a href="#13-5-3-LoginMgrController" class="headerlink" title="13.5.3 LoginMgrController"></a>13.5.3 LoginMgrController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servletProject.servlet.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.entity.Manager;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.ManagerService;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.impl.ManagerServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;LoginMgrController&quot;,value = &quot;/loginMgr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginMgrController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.处理乱码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">//2.收参</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="comment">//3.调用业务方法</span></span><br><span class="line">        <span class="type">ManagerService</span> <span class="variable">managerService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ManagerServiceImpl</span>();</span><br><span class="line">        <span class="type">Manager</span> <span class="variable">mgr</span> <span class="operator">=</span> managerService.login(username,password);</span><br><span class="line">        <span class="comment">//4.处理结果，流程跳转</span></span><br><span class="line">        <span class="keyword">if</span>(mgr!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//登录成功</span></span><br><span class="line">            <span class="comment">//将管理员信息存储在Session里</span></span><br><span class="line">            <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">&quot;mgr&quot;</span>,mgr);</span><br><span class="line">            <span class="comment">//跳转  目标、方式</span></span><br><span class="line">            response.sendRedirect(<span class="string">&quot;/WebProject_war_exploded/showallcontroller&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//登录失败</span></span><br><span class="line">            response.sendRedirect(<span class="string">&quot;/WebProject_war_exploded/loginMgr.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="13-5-4-ShowAllAdminController"><a href="#13-5-4-ShowAllAdminController" class="headerlink" title="13.5.4 ShowAllAdminController"></a>13.5.4 ShowAllAdminController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servletProject.servlet.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.entity.Admin;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.entity.Manager;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.AdminService;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.impl.AdminServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.RequestDispatcher;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(value = &quot;/showallcontroller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllAdminController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//通过HttpSession完成权限控制</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        <span class="type">Manager</span> <span class="variable">mgr</span>  <span class="operator">=</span>(Manager)session.getAttribute(<span class="string">&quot;mgr&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(mgr !=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//只负责调用业务逻辑功能</span></span><br><span class="line">            <span class="type">AdminService</span> <span class="variable">adminService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">            List&lt;Admin&gt; adminList = adminService.showAllAdmin();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//request作用域存储数据</span></span><br><span class="line">            req.setAttribute(<span class="string">&quot;admins&quot;</span>,adminList);</span><br><span class="line">            <span class="comment">//通过转发 跳转到显示结果servlet</span></span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/showalljsp&quot;</span>).forward(req,resp);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;/WebProject_war_exploded/loginMgr.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="13-6-Session实战保存验证码"><a href="#13-6-Session实战保存验证码" class="headerlink" title="13.6 Session实战保存验证码"></a>13.6 Session实战保存验证码</h4><h5 id="13-6-1-创建验证码"><a href="#13-6-1-创建验证码" class="headerlink" title="13.6.1 创建验证码"></a>13.6.1 创建验证码</h5><blockquote>
<ul>
<li><p>导入ValidateCode.jar</p>
</li>
<li><p>创建生成验证码的Servlet</p>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class CreateCode</span></span><br><span class="line"><span class="comment"> * 验证码的生成</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/createcode&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateCode</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		ValidateCode vc=<span class="keyword">new</span> <span class="title class_">ValidateCode</span>(<span class="number">200</span>, <span class="number">30</span>, <span class="number">4</span>, <span class="number">10</span>);</span><br><span class="line">		String code=vc.getCode();</span><br><span class="line">		System.out.println(request.getRemoteAddr()+<span class="string">&quot;:生成:&quot;</span>+code);</span><br><span class="line">		<span class="comment">//使用Session存储生成的验证码</span></span><br><span class="line">		HttpSession session=request.getSession();</span><br><span class="line">      	session.setAttribute(<span class="string">&quot;code&quot;</span>,code);</span><br><span class="line">        <span class="comment">//响应给客户端</span></span><br><span class="line">		vc.write(response.getOutputStream());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="13-6-2-登录页面"><a href="#13-6-2-登录页面" class="headerlink" title="13.6.2 登录页面"></a>13.6.2 登录页面</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>管理员登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/WebProject_war_exploded/loginMgr&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        验证码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;inputVcode&quot;</span>/&gt;</span> <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/WebProject_war_exploded/createcode&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="13-6-3-LoginMgrController"><a href="#13-6-3-LoginMgrController" class="headerlink" title="13.6.3 LoginMgrController"></a>13.6.3 LoginMgrController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servletProject.servlet.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.entity.Manager;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.ManagerService;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.impl.ManagerServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;LoginMgrController&quot;, value = &quot;/loginMgr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginMgrController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.处理乱码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.收参</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">inputVcode</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;inputVcode&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">codes</span> <span class="operator">=</span> (String) request.getSession().getAttribute(<span class="string">&quot;codes&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!inputVcode.isEmpty() &amp;&amp; inputVcode.equalsIgnoreCase(codes)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.调用业务方法</span></span><br><span class="line">            <span class="type">ManagerService</span> <span class="variable">managerService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ManagerServiceImpl</span>();</span><br><span class="line">            <span class="type">Manager</span> <span class="variable">mgr</span> <span class="operator">=</span> managerService.login(username, password);</span><br><span class="line">            <span class="comment">//4.处理结果，流程跳转</span></span><br><span class="line">            <span class="keyword">if</span> (mgr != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//登录成功</span></span><br><span class="line">                <span class="comment">//将管理员信息存储在Session里</span></span><br><span class="line">                <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">                session.setAttribute(<span class="string">&quot;mgr&quot;</span>, mgr);</span><br><span class="line">                <span class="comment">//跳转  目标、方式</span></span><br><span class="line">                response.sendRedirect(<span class="string">&quot;/WebProject_war_exploded/showallcontroller&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//登录失败</span></span><br><span class="line">                response.sendRedirect(<span class="string">&quot;/WebProject_war_exploded/loginMgr.html&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            response.sendRedirect(<span class="string">&quot;/WebProject_war_exploded/loginMgr.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="十四、ServletContext对象【重点】"><a href="#十四、ServletContext对象【重点】" class="headerlink" title="十四、ServletContext对象【重点】"></a>十四、ServletContext对象【<code>重点</code>】</h3><hr>
<h4 id="14-1-ServletContext概述"><a href="#14-1-ServletContext概述" class="headerlink" title="14.1 ServletContext概述"></a>14.1 ServletContext概述</h4><blockquote>
<ul>
<li><p>全局对象，也拥有作用域，对应一个Tomcat中的Web应用</p>
</li>
<li><p>当Web服务器启动时，会为每一个Web应用程序创建一块共享的存储区域（ServletContext）。</p>
</li>
<li><p>ServletContext在Web服务器启动时创建，服务器关闭时销毁。</p>
</li>
</ul>
</blockquote>
<h4 id="14-2-获取ServletContext对象"><a href="#14-2-获取ServletContext对象" class="headerlink" title="14.2 获取ServletContext对象"></a>14.2 获取ServletContext对象</h4><blockquote>
<ul>
<li><p>GenericServlet提供了getServletContext()方法。（推荐） this.getServletContext();</p>
</li>
<li><p>HttpServletRequest提供了getServletContext()方法。(推荐)</p>
</li>
<li><p>HttpSession提供了getServletContext()方法。</p>
</li>
</ul>
</blockquote>
<h4 id="14-3-ServletContext作用"><a href="#14-3-ServletContext作用" class="headerlink" title="14.3 ServletContext作用"></a>14.3 ServletContext作用</h4><h5 id="14-3-1-获取项目真实路径"><a href="#14-3-1-获取项目真实路径" class="headerlink" title="14.3.1 获取项目真实路径"></a>14.3.1 获取项目真实路径</h5><blockquote>
<p>获取当前项目在服务器发布的真实路径</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String realpath=servletContext.getRealPath(<span class="string">&quot;/&quot;</span>);</span><br></pre></td></tr></table></figure>



<h5 id="14-3-2-获取项目上下文路径"><a href="#14-3-2-获取项目上下文路径" class="headerlink" title="14.3.2 获取项目上下文路径"></a>14.3.2 获取项目上下文路径</h5><blockquote>
<p>获取当前项目上下文路径（应用程序名称）</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(servletContext.getContextPath());<span class="comment">//上下文路径（应用程序名称）</span></span><br><span class="line">System.out.println(request.getContextPath());</span><br></pre></td></tr></table></figure>



<h5 id="14-3-3-全局容器"><a href="#14-3-3-全局容器" class="headerlink" title="14.3.3 全局容器"></a>14.3.3 全局容器</h5><blockquote>
<p>ServletContext拥有作用域，可以存储数据到全局容器中</p>
<ul>
<li><p>存储数据：servletContext.setAttribute(“name”,value);</p>
</li>
<li><p>获取数据：servletContext.getAttribute(“name”);</p>
</li>
<li><p>移除数据：servletContext.removeAttribute(“name”);</p>
</li>
</ul>
</blockquote>
<h4 id="14-4-ServletContext特点"><a href="#14-4-ServletContext特点" class="headerlink" title="14.4 ServletContext特点"></a>14.4 ServletContext特点</h4><blockquote>
<ul>
<li><p>唯一性: 一个应用对应一个ServletContext。</p>
</li>
<li><p>生命周期: 只要容器不关闭或者应用不卸载，ServletContext就一直存在。</p>
</li>
</ul>
</blockquote>
<h4 id="14-5-ServletContext应用场景"><a href="#14-5-ServletContext应用场景" class="headerlink" title="14.5 ServletContext应用场景"></a>14.5 ServletContext应用场景</h4><blockquote>
<p>ServletContext统计当前项目访问次数</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class Servlet3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/servlet3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet3</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">		response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="type">ServletContext</span> <span class="variable">application</span> <span class="operator">=</span> request.getServletContext();</span><br><span class="line">		Integer count=(Integer) application.getAttribute(<span class="string">&quot;count&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span>(count==<span class="literal">null</span>) &#123;</span><br><span class="line">			count=<span class="number">1</span>;</span><br><span class="line">			application.setAttribute(<span class="string">&quot;count&quot;</span>, count);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			count++;</span><br><span class="line">			application.setAttribute(<span class="string">&quot;count&quot;</span>, count);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		PrintWriter out=response.getWriter();</span><br><span class="line">		out.write(<span class="string">&quot;servlet共访问次数：&quot;</span>+count);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="14-6-作用域总结"><a href="#14-6-作用域总结" class="headerlink" title="14.6 作用域总结"></a>14.6 作用域总结</h4><blockquote>
<ul>
<li>HttpServletRequest：一次请求，请求响应之前有效</li>
<li>HttpSession：一次会话开始，浏览器不关闭或不超时之前有效</li>
<li>ServletContext：服务器启动开始，服务器停止之前有效</li>
</ul>
</blockquote>
<h3 id="十五、过滤器【重点】"><a href="#十五、过滤器【重点】" class="headerlink" title="十五、过滤器【重点】"></a>十五、过滤器【<code>重点</code>】</h3><hr>
<h4 id="15-1-现有问题"><a href="#15-1-现有问题" class="headerlink" title="15.1 现有问题"></a>15.1 现有问题</h4><blockquote>
<p>在以往的Servlet中，有没有冗余的代码，多个Servlet都要进行编写。</p>
</blockquote>
<h4 id="15-2-概念"><a href="#15-2-概念" class="headerlink" title="15.2 概念"></a>15.2 概念</h4><blockquote>
<p>过滤器（Filter）是处于客户端与服务器目标资源之间的一道过滤技术。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">过滤器</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122239057.png" alt="image-20200423124307700"></td>
</tr>
</tbody></table>
<h4 id="15-3-过滤器作用"><a href="#15-3-过滤器作用" class="headerlink" title="15.3 过滤器作用"></a>15.3 过滤器作用</h4><blockquote>
<ul>
<li><p>执行地位在Servlet之前，客户端发送请求时，会先经过Filter，再到达目标Servlet中；响应时，会根据执行流程再次反向执行Filter</p>
</li>
<li><p>可以解决多个Servlet共性代码的冗余问题（例如：乱码处理、登录验证）</p>
</li>
</ul>
</blockquote>
<h4 id="15-4-编写过滤器"><a href="#15-4-编写过滤器" class="headerlink" title="15.4 编写过滤器"></a>15.4 编写过滤器</h4><blockquote>
<p>Servlet API中提供了一个Filter接口，开发人员编写一个Java类实现了这个接口即可，这个Java类称之为过滤器（Filter）</p>
</blockquote>
<h5 id="15-4-1-实现过程"><a href="#15-4-1-实现过程" class="headerlink" title="15.4.1 实现过程"></a>15.4.1 实现过程</h5><blockquote>
<ul>
<li><p>编写Java类实现Filter接口</p>
</li>
<li><p>在doFilter方法中编写拦截逻辑</p>
</li>
<li><p>设置拦截路径</p>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.web.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(&quot;/myservlet1&quot;)</span><span class="comment">//过滤路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFilter1</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化过滤器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器初始化了........init...  &quot;</span>+filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行过滤</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤前........doFilter &quot;</span>);</span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;过滤后.......doFilter&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//销毁</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;销毁了.....destroy&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="15-5-过滤器配置"><a href="#15-5-过滤器配置" class="headerlink" title="15.5 过滤器配置"></a>15.5 过滤器配置</h4><h5 id="15-5-1-注解配置"><a href="#15-5-1-注解配置" class="headerlink" title="15.5.1 注解配置"></a>15.5.1 注解配置</h5><blockquote>
<p>在自定义的Filter类上使用注解@WebFilter(value&#x3D;“&#x2F;过滤目标资源”)</p>
</blockquote>
<h5 id="15-5-2-xml配置"><a href="#15-5-2-xml配置" class="headerlink" title="15.5.2 xml配置"></a>15.5.2 xml配置</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--过滤器的xml配置  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--名称--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>sf<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--过滤器类全称--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.qf.web.filter.SecondFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--映射路径配置--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--名称--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>sf<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--过滤的url匹配规则和Servlet类似--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="15-5-3-过滤器路径"><a href="#15-5-3-过滤器路径" class="headerlink" title="15.5.3 过滤器路径"></a>15.5.3 过滤器路径</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">过滤器的过滤路径通常有三种形式:</span><br><span class="line"></span><br><span class="line">精确过滤匹配 ，比如/index.jsp   /myservlet1</span><br><span class="line"></span><br><span class="line">后缀过滤匹配，比如*.jsp、*.html、*.jpg</span><br><span class="line"></span><br><span class="line">通配符过滤匹配/*，表示拦截所有。注意过滤器不能使用/匹配。</span><br><span class="line">	/aaa/bbb/* 允许</span><br></pre></td></tr></table></figure>



<h4 id="15-6-过滤器链和优先级"><a href="#15-6-过滤器链和优先级" class="headerlink" title="15.6 过滤器链和优先级"></a>15.6 过滤器链和优先级</h4><h5 id="15-6-1-过滤器链"><a href="#15-6-1-过滤器链" class="headerlink" title="15.6.1 过滤器链"></a>15.6.1 过滤器链</h5><blockquote>
<p>客户端对服务器请求之后，服务器调用Servlet之前会执行一组过滤器（多个过滤器），那么这组过滤器就称为一条过滤器链。</p>
<p>每个过滤器实现某个特定的功能，当第一个Filter的doFilter方法被调用时，Web服务器会创建一个代表Filter链的FilterChain对象传递给该方法。在doFilter方法中，开发人员如果调用了FilterChain对象的doFilter方法，则Web服务器会检查FilterChain对象中是否还有filter，如果有，则调用第2个filter，如果没有，则调用目标资源。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">过滤器链</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://gitee.com/lan-xiaodong/myblog/raw/master/img/202304122235567.png" alt="image-20200422212814562"></td>
</tr>
</tbody></table>
<h5 id="15-6-2-过滤器优先级"><a href="#15-6-2-过滤器优先级" class="headerlink" title="15.6.2 过滤器优先级"></a>15.6.2 过滤器优先级</h5><blockquote>
<p>在一个Web应用中，可以开发编写多个Filter，这些Filter组合起来称之为一个Filter链。<br>优先级：	</p>
<ul>
<li><p>如果为注解的话，是按照类全名称的字符串顺序决定作用顺序</p>
</li>
<li><p>如果web.xml，按照 filter-mapping注册顺序，从上往下</p>
</li>
<li><p>web.xml配置高于注解方式</p>
</li>
<li><p>如果注解和web.xml同时配置，会创建多个过滤器对象，造成过滤多次。</p>
</li>
</ul>
</blockquote>
<h4 id="15-7-过滤器典型应用"><a href="#15-7-过滤器典型应用" class="headerlink" title="15.7 过滤器典型应用"></a>15.7 过滤器典型应用</h4><h5 id="15-7-1-过滤器解决编码"><a href="#15-7-1-过滤器解决编码" class="headerlink" title="15.7.1 过滤器解决编码"></a>15.7.1 过滤器解决编码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="meta">@WebFilter(value = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncodingFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">//统一处理请求和响应的乱码</span></span><br><span class="line">        servletRequest.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        servletResponse.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="15-7-2-权限验证"><a href="#15-7-2-权限验证" class="headerlink" title="15.7.2 权限验证"></a>15.7.2 权限验证</h5><blockquote>
<p>ShowAllAdminController</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servletProject.servlet.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.entity.Admin;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.entity.Manager;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.AdminService;</span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.service.impl.AdminServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.RequestDispatcher;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(value = &quot;/showallcontroller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllAdminController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"><span class="comment">//        //通过HttpSession完成权限控制</span></span><br><span class="line"><span class="comment">//        HttpSession session = req.getSession();</span></span><br><span class="line"><span class="comment">//        Manager mgr  =(Manager)session.getAttribute(&quot;mgr&quot;);</span></span><br><span class="line"><span class="comment">//        if(mgr !=null)&#123;</span></span><br><span class="line">            <span class="comment">//只负责调用业务逻辑功能</span></span><br><span class="line">            <span class="type">AdminService</span> <span class="variable">adminService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">            List&lt;Admin&gt; adminList = adminService.showAllAdmin();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//request作用域存储数据</span></span><br><span class="line">            req.setAttribute(<span class="string">&quot;admins&quot;</span>,adminList);</span><br><span class="line">            <span class="comment">//通过转发 跳转到显示结果servlet</span></span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/showalljsp&quot;</span>).forward(req,resp);</span><br><span class="line"><span class="comment">//        &#125;else&#123;</span></span><br><span class="line"><span class="comment">//            resp.sendRedirect(&quot;/WebProject_war_exploded/loginMgr.html&quot;);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>CheckFilter</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.servletProject.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.servletProject.entity.Manager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="meta">@WebFilter(value = &quot;/showallcontroller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">//权限验证   验证管理员是否登录！</span></span><br><span class="line">        <span class="comment">//向下转型  拆箱</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest)servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse)servletResponse;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span>request.getSession();</span><br><span class="line">        <span class="type">Manager</span> <span class="variable">mgr</span> <span class="operator">=</span> (Manager) session.getAttribute(<span class="string">&quot;mgr&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(mgr!=<span class="literal">null</span>)&#123;<span class="comment">//登录过！</span></span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            response.sendRedirect(request.getContextPath()+<span class="string">&quot;/loginMgr.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="十六、综合案例（EmpProject）"><a href="#十六、综合案例（EmpProject）" class="headerlink" title="十六、综合案例（EmpProject）"></a>十六、综合案例（EmpProject）</h3><hr>
<h4 id="16-1-数据库环境搭建"><a href="#16-1-数据库环境搭建" class="headerlink" title="16.1 数据库环境搭建"></a>16.1 数据库环境搭建</h4><blockquote>
<p>该案例是EmpProject员工管理系统。使用了两张表</p>
<ul>
<li>EMP 员工信息表</li>
<li>EmpManager 管理员表</li>
</ul>
</blockquote>
<h5 id="16-1-1-创建数据库"><a href="#16-1-1-创建数据库" class="headerlink" title="16.1.1 创建数据库"></a>16.1.1 创建数据库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE EMP;</span><br></pre></td></tr></table></figure>



<h5 id="16-1-2-创建数据表"><a href="#16-1-2-创建数据表" class="headerlink" title="16.1.2 创建数据表"></a>16.1.2 创建数据表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE EMP(</span><br><span class="line">	ID INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    NAME VARCHAR(20) NOT NULL,</span><br><span class="line">    SALARY DOUBLE NOT NULL,</span><br><span class="line">    AGE INT NOT NULL</span><br><span class="line">)CHARSET=UTF8;</span><br><span class="line"></span><br><span class="line">CREATE TABLE EmpManager(</span><br><span class="line">    USERNAME VARCHAR(20) NOT NULL,</span><br><span class="line">    PASSWORD VARCHAR(20) NOT NULL</span><br><span class="line">)CHARSET=UTF8;</span><br></pre></td></tr></table></figure>



<h4 id="16-2-创建Web项目"><a href="#16-2-创建Web项目" class="headerlink" title="16.2 创建Web项目"></a>16.2 创建Web项目</h4><blockquote>
<p>创建Web项目，导入相关jar包</p>
<ul>
<li><p>commons-dbutils-1.7.jar</p>
</li>
<li><p>druid-1.1.5.jar</p>
</li>
<li><p>mysql-connector-java-5.1.25-bin.jar</p>
</li>
<li><p>ValidateCode.jar</p>
</li>
</ul>
</blockquote>
<h4 id="16-3-基础环境搭建"><a href="#16-3-基础环境搭建" class="headerlink" title="16.3 基础环境搭建"></a>16.3 基础环境搭建</h4><blockquote>
<p>项目下创建包目录结构</p>
<ul>
<li>com.qf.emp.controller   调用业务逻辑Servlet</li>
<li>com.qf.emp.dao      数据访问层</li>
<li>com.qf.emp.impl     数据访问层实现类</li>
<li>com.qf.emp.entity   实体类</li>
<li>com.qf.emp.filter     过滤器</li>
<li>com.qf.emp.jsp        打印显示页面Servlet</li>
<li>com.qf.emp.service  业务逻辑层</li>
<li>com.qf.emp.impl      业务逻辑层实现类</li>
<li>com.qf.emp.utils      工具类</li>
<li>database.properties  数据库连接及连接池配置文件</li>
</ul>
</blockquote>
<h4 id="16-4-管理员登录功能"><a href="#16-4-管理员登录功能" class="headerlink" title="16.4 管理员登录功能"></a>16.4 管理员登录功能</h4><blockquote>
<p>仅展示Controller代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.emp.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.emp.entity.EmpManager;</span><br><span class="line"><span class="keyword">import</span> com.qf.emp.service.EmpManagerService;</span><br><span class="line"><span class="keyword">import</span> com.qf.emp.service.impl.EmpManagerServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;EmpManagerLoginController&quot;,value = &quot;/manager/EmpManagerLoginController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpManagerLoginController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.收参</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">inputVcode</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;inputVcode&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.校验验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">codes</span> <span class="operator">=</span> (String)request.getSession().getAttribute(<span class="string">&quot;codes&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!inputVcode.isEmpty() &amp;&amp; inputVcode.equalsIgnoreCase(codes))&#123;</span><br><span class="line">            <span class="comment">//调用业务逻辑实现登录</span></span><br><span class="line">            <span class="type">EmpManagerService</span> <span class="variable">empManagerService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpManagerServiceImpl</span>();</span><br><span class="line">            <span class="type">EmpManager</span> <span class="variable">empManager</span> <span class="operator">=</span> empManagerService.login(username,password);</span><br><span class="line">            <span class="keyword">if</span>(empManager!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//登录成功</span></span><br><span class="line">                <span class="comment">//存储在session作用域</span></span><br><span class="line">                <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">                session.setAttribute(<span class="string">&quot;empManager&quot;</span>,empManager);</span><br><span class="line">                <span class="comment">//跳转到查询所有的controller</span></span><br><span class="line">                response.sendRedirect(request.getContextPath()+<span class="string">&quot;/manager/safe/showAllEmpController&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                response.sendRedirect(request.getContextPath()+<span class="string">&quot;/login.html&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//验证码输入错误，跳转到登录页面</span></span><br><span class="line">            response.sendRedirect(request.getContextPath()+<span class="string">&quot;/login.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="16-5-查询所有员工功能"><a href="#16-5-查询所有员工功能" class="headerlink" title="16.5 查询所有员工功能"></a>16.5 查询所有员工功能</h4><h5 id="16-5-1-调用业务逻辑Controller"><a href="#16-5-1-调用业务逻辑Controller" class="headerlink" title="16.5.1 调用业务逻辑Controller"></a>16.5.1 调用业务逻辑Controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.emp.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.emp.entity.Emp;</span><br><span class="line"><span class="keyword">import</span> com.qf.emp.service.EmpService;</span><br><span class="line"><span class="keyword">import</span> com.qf.emp.service.impl.EmpServiceImpl;</span><br><span class="line"><span class="keyword">import</span> sun.security.util.AuthResources_it;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;ShowAllEmpController&quot;,value = &quot;/manager/safe/showAllEmpController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllEmpController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">		<span class="comment">//权限验证存放在过滤器实现</span></span><br><span class="line">        <span class="type">EmpService</span> <span class="variable">empService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpServiceImpl</span>();</span><br><span class="line">        List&lt;Emp&gt; emps = empService.showAllEmp();</span><br><span class="line"></span><br><span class="line">        request.setAttribute(<span class="string">&quot;emps&quot;</span>,emps);</span><br><span class="line"></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/manager/safe/showAllEmpJSP&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="16-5-2-显示页面JSP"><a href="#16-5-2-显示页面JSP" class="headerlink" title="16.5.2 显示页面JSP"></a>16.5.2 显示页面JSP</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.emp.jsp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.emp.entity.Emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;ShowAllEmpJSP&quot;,value = &quot;/manager/safe/showAllEmpJSP&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllEmpJSP</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.获取集合数据</span></span><br><span class="line">        List&lt;Emp&gt; emps = (List&lt;Emp&gt;)request.getAttribute(<span class="string">&quot;emps&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">printWriter</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line"></span><br><span class="line">        printWriter.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;   &lt;head&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       &lt;meta charset=&#x27;UTF-8&#x27;&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       &lt;title&gt;查询所有员工页面&lt;/title&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;   &lt;/head&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;   &lt;body&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       &lt;table border=&#x27;1&#x27;&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;           &lt;tr&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;               &lt;td&gt;编号&lt;/td&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;               &lt;td&gt;姓名&lt;/td&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;               &lt;td&gt;工资&lt;/td&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;               &lt;td&gt;年龄&lt;/td&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;               &lt;td colspan=&#x27;2&#x27;&gt;操作&lt;/td&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;           &lt;/tr&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(Emp emp: emps)&#123;</span><br><span class="line">            printWriter.println(<span class="string">&quot;           &lt;tr&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;               &lt;td&gt;&quot;</span>+emp.getId()+<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;               &lt;td&gt;&quot;</span>+emp.getName()+<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;               &lt;td&gt;&quot;</span>+emp.getSalary()+<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;               &lt;td&gt;&quot;</span>+emp.getAge()+<span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;               &lt;td&gt;&lt;a href=&#x27;&quot;</span>+request.getContextPath()+<span class="string">&quot;/manager/safe/removeEmpController?id=&quot;</span>+emp.getId()+<span class="string">&quot;&#x27;&gt;删除&lt;a&gt;&lt;/td&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;               &lt;td&gt;&lt;a href=&#x27;&quot;</span>+request.getContextPath()+<span class="string">&quot;/manager/safe/showEmpController?id=&quot;</span>+emp.getId()+<span class="string">&quot;&#x27;&gt;修改&lt;/a&gt;&lt;/td&gt;&quot;</span>);</span><br><span class="line">            printWriter.println(<span class="string">&quot;           &lt;/tr&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        printWriter.println(<span class="string">&quot;       &lt;/table&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;   &lt;/body&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="16-5-3-权限验证过滤器"><a href="#16-5-3-权限验证过滤器" class="headerlink" title="16.5.3 权限验证过滤器"></a>16.5.3 权限验证过滤器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.emp.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.emp.entity.EmpManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="meta">@WebFilter(value = &quot;/manager/safe/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest)servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse)servletResponse;</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="type">EmpManager</span> <span class="variable">empManager</span> <span class="operator">=</span> (EmpManager)session.getAttribute(<span class="string">&quot;empManager&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(empManager!=<span class="literal">null</span>)&#123;<span class="comment">//登录过</span></span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            response.sendRedirect(request.getContextPath()+<span class="string">&quot;/login.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="16-5-4-字符编码过滤器"><a href="#16-5-4-字符编码过滤器" class="headerlink" title="16.5.4 字符编码过滤器"></a>16.5.4 字符编码过滤器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.emp.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="meta">@WebFilter(value = &quot;/manager/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncodingFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        servletRequest.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        servletResponse.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="16-6-删除员工功能"><a href="#16-6-删除员工功能" class="headerlink" title="16.6 删除员工功能"></a>16.6 删除员工功能</h4><h5 id="16-6-1-删除员工Controller"><a href="#16-6-1-删除员工Controller" class="headerlink" title="16.6.1 删除员工Controller"></a>16.6.1 删除员工Controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.emp.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.emp.service.EmpService;</span><br><span class="line"><span class="keyword">import</span> com.qf.emp.service.impl.EmpServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;RemoveEmpController&quot;,value = &quot;/manager/safe/removeEmpController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoveEmpController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">id</span> <span class="operator">=</span> Integer.valueOf(request.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">EmpService</span> <span class="variable">empService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">        empService.removeEmp(id);</span><br><span class="line"></span><br><span class="line">        response.sendRedirect(request.getContextPath()+<span class="string">&quot;/manager/safe/showAllEmpController&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="16-7-修改员工功能"><a href="#16-7-修改员工功能" class="headerlink" title="16.7 修改员工功能"></a>16.7 修改员工功能</h4><h5 id="16-7-1-查询单个员工Controller"><a href="#16-7-1-查询单个员工Controller" class="headerlink" title="16.7.1 查询单个员工Controller"></a>16.7.1 查询单个员工Controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.emp.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.emp.entity.Emp;</span><br><span class="line"><span class="keyword">import</span> com.qf.emp.service.EmpService;</span><br><span class="line"><span class="keyword">import</span> com.qf.emp.service.impl.EmpServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;ShowEmpController&quot;,value = &quot;/manager/safe/showEmpController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowEmpController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">id</span> <span class="operator">=</span> Integer.valueOf(request.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">EmpService</span> <span class="variable">empService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpServiceImpl</span>();</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> empService.showEmp(id);</span><br><span class="line"></span><br><span class="line">        request.setAttribute(<span class="string">&quot;emp&quot;</span>,emp);</span><br><span class="line"></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/manager/safe/showUpdateEmpInfoJSP&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="16-7-2-显示修改页面JSP"><a href="#16-7-2-显示修改页面JSP" class="headerlink" title="16.7.2 显示修改页面JSP"></a>16.7.2 显示修改页面JSP</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.emp.jsp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.emp.entity.Emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;ShowUpdateEmpInfoController&quot;,value = &quot;/manager/safe/showUpdateEmpInfoJSP&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowUpdateEmpInfoController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> (Emp)request.getAttribute(<span class="string">&quot;emp&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">printWriter</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line"></span><br><span class="line">        printWriter.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;   &lt;head&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       &lt;meta charset=&#x27;UTF-8&#x27;&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       &lt;title&gt;修改员工信息页面&lt;/title&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;   &lt;/head&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;   &lt;body&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       &lt;form action=&#x27;/empproject/manager/safe/updateEmpController&#x27; method=&#x27;post&#x27;&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       编号：&lt;input type=&#x27;text&#x27; name=&#x27;id&#x27; value=&#x27;&quot;</span>+emp.getId()+<span class="string">&quot;&#x27; readonly/&gt;&lt;br/&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       姓名：&lt;input type=&#x27;text&#x27; name=&#x27;name&#x27; value=&#x27;&quot;</span>+emp.getName()+<span class="string">&quot;&#x27;/&gt;&lt;br/&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       工资：&lt;input type=&#x27;text&#x27; name=&#x27;salary&#x27; value=&#x27;&quot;</span>+emp.getSalary()+<span class="string">&quot;&#x27;/&gt;&lt;br/&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       年龄：&lt;input type=&#x27;text&#x27; name=&#x27;age&#x27; value=&#x27;&quot;</span>+emp.getAge()+<span class="string">&quot;&#x27;/&gt;&lt;br/&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       &lt;input type=&#x27;submit&#x27;  value=&#x27;修改&#x27;/&gt;&lt;br/&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;       &lt;/form&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;   &lt;/body&gt;&quot;</span>);</span><br><span class="line">        printWriter.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="16-7-3-修改员工信息Controller"><a href="#16-7-3-修改员工信息Controller" class="headerlink" title="16.7.3 修改员工信息Controller"></a>16.7.3 修改员工信息Controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.emp.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.emp.entity.Emp;</span><br><span class="line"><span class="keyword">import</span> com.qf.emp.service.EmpService;</span><br><span class="line"><span class="keyword">import</span> com.qf.emp.service.impl.EmpServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;UpdateEmpController&quot;,value = &quot;/manager/safe/updateEmpController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateEmpController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1.收参</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">id</span> <span class="operator">=</span> Integer.valueOf(request.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">Double</span> <span class="variable">salary</span> <span class="operator">=</span> Double.valueOf(request.getParameter(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">age</span> <span class="operator">=</span> Integer.valueOf(request.getParameter(<span class="string">&quot;age&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(id,name,salary,age);</span><br><span class="line"></span><br><span class="line">        <span class="type">EmpService</span> <span class="variable">empService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpServiceImpl</span>();</span><br><span class="line">        empService.modify(emp);</span><br><span class="line"></span><br><span class="line">        response.sendRedirect(request.getContextPath()+<span class="string">&quot;/manager/safe/showAllEmpController&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://laneng.github.io/2019/04/24/Servlet/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/servlet/" rel="tag">servlet</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2019/04/24/AJAX/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            ajax
          
        </div>
      </a>
    
    
  </nav>

  
   
  
   
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2023
        <i class="ri-heart-fill heart_icon"></i> lxd
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="个人博客"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/player">旅行</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/11.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/22.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->
 
<script src="/js/clickBoom2.js"></script>
 
<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="86"
        src="//music.163.com/outchain/player?type=2&id=22707008&auto=1&height=66"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    

  </div>
</body>

</html>